
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CJB - Hexo</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="Update：2022-10-21 20:57:20 更改了问题 12 代码的小错误。
Update：2022-10-23 22:06:30 增加了问题 14。

莫比乌斯反演积性函数$$\begi,"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="Hexo" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="CJB - Hexo"/>
    <meta name="twitter:description" content="Update：2022-10-21 20:57:20 更改了问题 12 代码的小错误。
Update：2022-10-23 22:06:30 增加了问题 14。

莫比乌斯反演积性函数$$\begi,"/>
    
    
    
    
    <meta property="og:site_name" content="Hexo"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="CJB - Hexo"/>
    <meta property="og:description" content="Update：2022-10-21 20:57:20 更改了问题 12 代码的小错误。
Update：2022-10-23 22:06:30 增加了问题 14。

莫比乌斯反演积性函数$$\begi,"/>
    
<link rel="stylesheet" href="/css/diaspora.css">

    <script>window.searchDbPath = "/search.xml";</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Hexo</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://example.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">CJB</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">CJB</h1>
        <div class="stuff">
            <span>十月 26, 2022</span>
            

        </div>
        <div class="content markdown">
            <p>Update：2022-10-21 20:57:20 更改了问题 12 代码的小错误。</p>
<p>Update：2022-10-23 22:06:30 增加了问题 14。</p>
<hr>
<h1 id="莫比乌斯反演"><a href="#莫比乌斯反演" class="headerlink" title="莫比乌斯反演"></a>莫比乌斯反演</h1><h2 id="积性函数"><a href="#积性函数" class="headerlink" title="积性函数"></a>积性函数</h2><p>$$<br>\begin{aligned}<br>\mu&amp;:\mu(n)&#x3D;<br>\begin{cases}<br>1&amp;n&#x3D;1\<br>0&amp;\text{n含有平方因子}\<br>(-1)^k&amp;\text{k为本质不同的质因子个数}\<br>\end{cases}\<br>\tau&amp;:\tau(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}[i\mid n]\<br>\sigma&amp;:\sigma&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}[i\mid n]i\<br>\varphi&amp;:\varphi(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}[\gcd(i,n)&#x3D;1]\<br>1&amp;:1(n)&#x3D;1\<br>\varepsilon&amp;:\varepsilon(n)&#x3D;[n&#x3D;1]\<br>\operatorname{id}&amp;:\operatorname{id}(n)&#x3D;n\<br>\operatorname{id}&amp;:\operatorname{id_k}(n)&#x3D;n^k<br>\end{aligned}<br>$$</p>
<h2 id="数论分块"><a href="#数论分块" class="headerlink" title="数论分块"></a>数论分块</h2><h3 id="单元数论分块"><a href="#单元数论分块" class="headerlink" title="单元数论分块"></a>单元数论分块</h3><p>求解形如这种形式的式子：</p>
<p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\lfloor\frac{n}{i}\rfloor<br>$$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    r = n / (n / l);</span><br><span class="line">    \\doing something.</span><br><span class="line">    ans += (r - l + <span class="number">1</span>) * (n / l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二元数论分块"><a href="#二元数论分块" class="headerlink" title="二元数论分块"></a>二元数论分块</h3><p>求解形如这种形式的式子：</p>
<p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\lfloor\frac{n}{i}\rfloor\lfloor\frac{m}{i}\rfloor<br>$$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">    \\doing something.</span><br><span class="line">    ans += (r - l + <span class="number">1</span>) * (n / l) * (m / l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="狄利克雷卷积"><a href="#狄利克雷卷积" class="headerlink" title="狄利克雷卷积"></a>狄利克雷卷积</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>$$<br>(f*g)(n)&#x3D;\displaystyle\sum_{xy&#x3D;n}f(x)*g(x)<br>$$</p>
<p>等价于：</p>
<p>$$<br>(f*g)(n)&#x3D;\displaystyle\sum_{x\mid n}f(x)*g(\frac{n}{x})<br>$$</p>
<h3 id="重要结论"><a href="#重要结论" class="headerlink" title="重要结论"></a>重要结论</h3><p>$$<br>\begin{aligned}<br>1<em>1&amp;&#x3D;\tau\<br>\mu</em>1&amp;&#x3D;\varepsilon\<br>\varphi*1&amp;&#x3D;\operatorname{id}\<br>\operatorname{id}<em>\mu&amp;&#x3D;\varphi\<br>\mu</em>\tau&amp;&#x3D;1\<br>\end{aligned}<br>$$</p>
<h3 id="狄利克雷卷积-1"><a href="#狄利克雷卷积-1" class="headerlink" title="狄利克雷卷积"></a>狄利克雷卷积</h3><p>假设 $f(n)$ 已知，$g(n)$ 未知。</p>
<h4 id="狄利克雷前缀和"><a href="#狄利克雷前缀和" class="headerlink" title="狄利克雷前缀和"></a>狄利克雷前缀和</h4><p>$$<br>g(n)&#x3D;\displaystyle\sum_{d\mid n}f(d)<br>$$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(prime:begin-&gt;end)</span><br><span class="line">    <span class="keyword">for</span>(k:<span class="number">1</span>-&gt;n/prime)</span><br><span class="line">        g[i*prime]+=g[i];</span><br></pre></td></tr></table></figure>

<h4 id="狄利克雷后缀和"><a href="#狄利克雷后缀和" class="headerlink" title="狄利克雷后缀和"></a>狄利克雷后缀和</h4><p>$$<br>g(n)&#x3D;\displaystyle\sum_{n\mid d}f(d)<br>$$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(prime:begin-&gt;end)</span><br><span class="line">    <span class="keyword">for</span>(k:n/prime-&gt;<span class="number">1</span>)</span><br><span class="line">        g[i]+=g[i*prime];</span><br></pre></td></tr></table></figure>

<h4 id="逆狄利克雷前缀和"><a href="#逆狄利克雷前缀和" class="headerlink" title="逆狄利克雷前缀和"></a>逆狄利克雷前缀和</h4><p>$$<br>f(n)&#x3D;\displaystyle\sum_{d\mid n}g(d)<br>$$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(prime:end-&gt;begin)</span><br><span class="line">    <span class="keyword">for</span>(k:n/prime-&gt;<span class="number">1</span>)</span><br><span class="line">        g[i*prime]-=g[i];</span><br></pre></td></tr></table></figure>

<h4 id="逆狄利克雷后缀和"><a href="#逆狄利克雷后缀和" class="headerlink" title="逆狄利克雷后缀和"></a>逆狄利克雷后缀和</h4><p>$$<br>f(n)&#x3D;\displaystyle\sum_{n\mid d}g(d)<br>$$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(prime:end-&gt;begin)</span><br><span class="line">    <span class="keyword">for</span>(k:<span class="number">1</span>-&gt;n/prime)</span><br><span class="line">        g[i]-=g[i*prime];</span><br></pre></td></tr></table></figure>

<h2 id="莫比乌斯函数"><a href="#莫比乌斯函数" class="headerlink" title="莫比乌斯函数"></a>莫比乌斯函数</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><p>$$<br>\mu(n)&#x3D;<br>\begin{cases}<br>1&amp;n&#x3D;1\<br>0&amp;\text{n含有平方因子}\<br>(-1)^k&amp;\text{k为本质不同的质因子个数}\<br>\end{cases}<br>$$</p>
<h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><p>$(\mu*1)(n)&#x3D;\varepsilon(n)&#x3D;\displaystyle\sum_{d\mid n}\mu(d)&#x3D;[n&#x3D;1]$</p>
<p>$$<br>\displaystyle\sum_{d\mid n}\mu(d)&#x3D;<br>\begin{cases}<br>1&amp;n&#x3D;1\<br>0&amp;n\not&#x3D;1\<br>\end{cases}<br>$$</p>
<h3 id="线性筛-mu"><a href="#线性筛-mu" class="headerlink" title="线性筛 $\mu$"></a>线性筛 $\mu$</h3><p>$$<br>\begin{cases}<br>i&#x3D;1&amp;\mu(i)&#x3D;1\<br>i\in prime&amp;\mu(i)&#x3D;-1\<br>i\notin prime\land prime\mid i&amp;\mu(i<em>prime)&#x3D;0\<br>i\notin prime\land prime\nmid i&amp;\mu(i</em>prime)&#x3D;\mu(i)\times\mu(prime)&#x3D;-\mu(i)\<br>\end{cases}<br>$$</p>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = mu[i] * phi[p[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="欧拉函数"><a href="#欧拉函数" class="headerlink" title="欧拉函数"></a>欧拉函数</h2><h3 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h3><p>$\varphi(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}[\gcd(i,n)&#x3D;1]$</p>
<h3 id="性质-1"><a href="#性质-1" class="headerlink" title="性质"></a>性质</h3><p>$(\varphi*1)(n)&#x3D;\operatorname{id}(n)&#x3D;\displaystyle\sum_{d\mid n}\varphi(d)&#x3D;n$</p>
<h3 id="线性筛-varphi"><a href="#线性筛-varphi" class="headerlink" title="线性筛 $\varphi$"></a>线性筛 $\varphi$</h3><p>$$<br>\begin{cases}<br>i&#x3D;1&amp;\varphi(i)&#x3D;1\<br>i\in prime&amp;\varphi(i)&#x3D;i-1\<br>prime\mid i&amp;\varphi(i<em>prime)&#x3D;\varphi(i)\times prime\<br>prime\nmid i&amp;\varphi(i</em>prime)&#x3D;\varphi(i)\times \varphi(prime)&#x3D;\varphi(i)\times (prime-1)\<br>\end{cases}<br>$$</p>
<h3 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                phi[i * p[j]] = phi[i] * p[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            phi[i * p[j]] = phi[i] * phi[p[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="约数个数"><a href="#约数个数" class="headerlink" title="约数个数"></a>约数个数</h2><h3 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h3><p>$\tau(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}[i\mid n]$</p>
<h3 id="线性筛-tau"><a href="#线性筛-tau" class="headerlink" title="线性筛 $\tau$"></a>线性筛 $\tau$</h3><p>$$<br>\begin{aligned}<br>n&#x3D;\prod_{i&#x3D;1}p_i^{k_i}\<br>\tau(n)&#x3D;\prod_{i&#x3D;1}(k_i+1)<br>\end{aligned}<br>$$</p>
<p>设 $\tau$ 为 $f$，需要辅助数组为 $g$。</p>
<p>记 $g(n)$ 为 $n$ 最小质因子的次幂。</p>
<p>$$<br>\begin{cases}<br>i\in prime&amp;g(i)&#x3D;1\<br>prime\mid i&amp;g(i<em>prime)&#x3D;g(i)+1\<br>prime\nmid i&amp;g(i</em>prime)&#x3D;1\<br>\end{cases}<br>$$</p>
<p>$$<br>\begin{cases}<br>i&#x3D;1&amp;f(i)&#x3D;1\<br>i\in prime&amp;f(i)&#x3D;2\<br>prime\mid i&amp;f(i<em>prime)&#x3D;\frac{f(i)</em>(g(i<em>prime)+1)}{g(i)+1}\<br>prime\nmid i&amp;f(i</em>prime)&#x3D;f(i)<em>f(prime)&#x3D;2</em>f(i)\<br>\end{cases}<br>$$</p>
<h3 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    f[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    g[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            g[i] = <span class="number">1</span>;</span><br><span class="line">            f[i] = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                g[i * p[j]] = g[i] + <span class="number">1</span>;</span><br><span class="line">                f[i * p[j]] = f[i] / (g[i] + <span class="number">1</span>) * (g[i * p[j]] + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            g[i * p[j]] = <span class="number">1</span>;</span><br><span class="line">            f[i * p[j]] = f[i] * f[p[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="约数和"><a href="#约数和" class="headerlink" title="约数和"></a>约数和</h2><h3 id="定义-4"><a href="#定义-4" class="headerlink" title="定义"></a>定义</h3><p>$$<br>\sigma&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}[i\mid n]i<br>$$</p>
<h3 id="线性筛-sigma"><a href="#线性筛-sigma" class="headerlink" title="线性筛 $\sigma$"></a>线性筛 $\sigma$</h3><p>$$<br>\begin{aligned}<br>n&#x3D;\prod_{i&#x3D;1}p_i^{k_i}\<br>\sigma(n)&#x3D;\prod_{i&#x3D;1}\displaystyle\sum_{j&#x3D;0}^{k_i}p_i^j<br>\end{aligned}<br>$$</p>
<p>设 $\sigma$ 为 $f$，需要辅助数组为 $g$。</p>
<p>记 $g(n)$ 为 $\displaystyle\sum_{i&#x3D;0}p^i$，$p$ 为 $n$ 的最小质因子。</p>
<p>$$<br>\begin{cases}<br>i\in prime&amp;g(i)&#x3D;i+1\<br>prime\mid i&amp;g(i*prime)&#x3D;g(i)<em>prime+1\<br>prime\nmid i&amp;g(i</em>prime)&#x3D;prime+1\<br>\end{cases}<br>$$</p>
<p>$$<br>\begin{cases}<br>i&#x3D;1&amp;f(i)&#x3D;1\<br>i\in prime&amp;f(i)&#x3D;i+1\<br>prime\mid i&amp;f(i<em>prime)&#x3D;\frac{f(i)<em>g(i</em>prime)}{g(i)}\<br>prime\nmid i&amp;f(i</em>prime)&#x3D;f(i)*f(prime)&#x3D;(prime+1)*f(i)\<br>\end{cases}<br>$$</p>
<h3 id="Code-3"><a href="#Code-3" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    g[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    f[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            g[i] = i + <span class="number">1</span>;</span><br><span class="line">            f[i] = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                g[i * p[j]] = g[i] * p[j] + <span class="number">1</span>;</span><br><span class="line">                f[i * p[j]] = f[i] / g[i] * g[i * p[j]];</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            g[i * p[j]] = p[j] + <span class="number">1</span>;</span><br><span class="line">            f[i * p[j]] = f[i] * f[p[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="恒等函数"><a href="#恒等函数" class="headerlink" title="恒等函数"></a>恒等函数</h2><h3 id="定义-5"><a href="#定义-5" class="headerlink" title="定义"></a>定义</h3><p>$$<br>\begin{aligned}<br>\operatorname{id}(n)&amp;&#x3D;n\<br>\operatorname{id_k}(n)&amp;&#x3D;n^k<br>\end{aligned}<br>$$</p>
<h3 id="线性筛-operatorname-id-k"><a href="#线性筛-operatorname-id-k" class="headerlink" title="线性筛 $\operatorname{id_k}$"></a>线性筛 $\operatorname{id_k}$</h3><p>$$<br>\begin{cases}<br>i&#x3D;1&amp;\operatorname{id_k}(i)&#x3D;1\<br>i\in prime&amp;\operatorname{id_k}(i)&#x3D;i^k\<br>prime\mid i&amp;\operatorname{id_k}(i*prime)&#x3D;\operatorname{id_k}(i)<em>\operatorname{id_k}(prime)\<br>prime\nmid i&amp;\operatorname{id_k}(i</em>prime)&#x3D;\operatorname{id_k}(i)*\operatorname{id_k}(prime)\<br>\end{cases}<br>$$</p>
<h3 id="Code-4"><a href="#Code-4" class="headerlink" title="Code"></a>Code</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    idk[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            idk[i] = <span class="built_in">pow</span>(i, k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            idk[i * p[j]] = idk[i] * idk[p[j]];</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="莫比乌斯反演-1"><a href="#莫比乌斯反演-1" class="headerlink" title="莫比乌斯反演"></a>莫比乌斯反演</h2><h3 id="反演结论"><a href="#反演结论" class="headerlink" title="反演结论"></a>反演结论</h3><p>$\displaystyle\sum_{d\mid\gcd(i,j)}\mu(d)&#x3D;[\gcd(i,j)&#x3D;1]$</p>
<h3 id="证明："><a href="#证明：" class="headerlink" title="证明："></a>证明：</h3><p>$$<br>\begin{aligned}<br>(\mu*1)(\gcd(i,j))<br>&amp;&#x3D;\displaystyle\sum_{d\mid\gcd(i,j)}\mu(d)\<br>&amp;&#x3D;\varepsilon(\gcd(i,j))\<br>&amp;&#x3D;[\gcd(i,j)&#x3D;1]<br>\end{aligned}<br>$$</p>
<h2 id="欧拉反演"><a href="#欧拉反演" class="headerlink" title="欧拉反演"></a>欧拉反演</h2><h3 id="反演结论-1"><a href="#反演结论-1" class="headerlink" title="反演结论"></a>反演结论</h3><p>$\displaystyle\sum_{d\mid \gcd(i,j)}\varphi(d)&#x3D;\gcd(i,j)$</p>
<h3 id="证明：-1"><a href="#证明：-1" class="headerlink" title="证明："></a>证明：</h3><p>$$<br>\begin{aligned}<br>(\varphi*1)(\gcd(i,j))<br>&amp;&#x3D;\displaystyle\sum_{d\mid \gcd(i,j)}\varphi(d)\<br>&amp;&#x3D;\operatorname{id}(\gcd(i,j))\<br>&amp;&#x3D;\gcd(i,j)<br>\end{aligned}<br>$$</p>
<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>以下证明保证 $n\lt m$。</p>
<h3 id="Question-0"><a href="#Question-0" class="headerlink" title="Question 0"></a>Question 0</h3><h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;1]<br>$$</p>
<h4 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h4><p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;1]<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{d\mid\gcd(i,j)}\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{d\mid i\land d\mid j}\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{n}[d\mid i]\displaystyle\sum_{j&#x3D;1}^{m}[d\mid j]\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\lfloor\frac{n}{d}\rfloor\lfloor\frac{m}{d}\rfloor<br>\end{aligned}<br>$$</p>
<p>直接线性筛 $\mu$，数论分块就好了。顺便提一下：原题目的 $\gcd(n,0)&#x3D;n$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + mu[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">Euler</span>(n);</span><br><span class="line">    <span class="built_in">initival</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">1</span>; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (sum[r] - sum[l - <span class="number">1</span>]) * (n / l) * (m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-1"><a href="#Question-1" class="headerlink" title="Question 1"></a>Question 1</h3><h4 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;k]<br>$$</p>
<h4 id="证明-1"><a href="#证明-1" class="headerlink" title="证明"></a>证明</h4><p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;k]<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}[k\mid i]\displaystyle\sum_{j&#x3D;1}^{m}[k\mid j][\gcd(\frac{i}{k},\frac{j}{k})&#x3D;\frac{k}{k}]\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{k}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{k}\rfloor}[\gcd(i,j)&#x3D;1]\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{k}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{k}\rfloor}\displaystyle\sum_{d\mid \gcd(i,j)}\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{\lfloor\frac{n}{k}\rfloor}\mu(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{k}\rfloor}[d\mid i]\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{k}\rfloor}[d\mid j]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{\lfloor\frac{n}{k}\rfloor}\mu(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{kd}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{kd}\rfloor}1\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{\lfloor\frac{n}{k}\rfloor}\mu(d)\lfloor\frac{n}{kd}\rfloor\lfloor\frac{m}{kd}\rfloor\<br>\end{aligned}<br>$$</p>
<p>发现最后的式子可以二元数论分块，预处理 $\mu$ 的前缀和。</p>
<h4 id="Code-5"><a href="#Code-5" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, k, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + mu[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    n /= k, m /= k;</span><br><span class="line">    <span class="built_in">Euler</span>(n);</span><br><span class="line">    <span class="built_in">initival</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">1</span>; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (sum[r] - sum[l - <span class="number">1</span>]) * (n / l) * (m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-2"><a href="#Question-2" class="headerlink" title="Question 2"></a>Question 2</h3><h4 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)\in prime]<br>$$</p>
<h4 id="证明-2"><a href="#证明-2" class="headerlink" title="证明"></a>证明</h4><p>继承 $\operatorname{Problem 1}$ 的结论：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)\in prime]<br>&amp;&#x3D;\displaystyle\sum_{k\in prime}\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;k]\<br>&amp;&#x3D;\displaystyle\sum_{k\in prime}\displaystyle\sum_{d&#x3D;1}^{\lfloor\frac{n}{k}\rfloor}\mu(d)\lfloor\frac{n}{kd}\rfloor\lfloor\frac{m}{kd}\rfloor<br>\end{aligned}<br>$$</p>
<p>Err，式子推到这里还不行，$\operatorname{TLE}$，还需要深度推理。</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{k\in prime}\displaystyle\sum_{d&#x3D;1}^{\lfloor\frac{n}{k}\rfloor}\mu(d)\lfloor\frac{n}{kd}\rfloor\lfloor\frac{m}{kd}\rfloor<br>&amp;&#x3D;\displaystyle\sum_{k\in prime}\displaystyle\sum_{d&#x3D;1}^{\lfloor\frac{n}{k}\rfloor}\mu(d)\lfloor\frac{n}{T}\rfloor\lfloor\frac{m}{T}\rfloor\<br>&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{n}\lfloor\frac{n}{T}\rfloor\lfloor\frac{m}{T}\rfloor\displaystyle\sum_{k\mid T\land k\in prime}\mu(\frac{T}{k})<br>\end{aligned}<br>$$</p>
<p>解释最后一步怎么来的：既然要把 $T&#x3D;kd$ 提出来作为枚举项，则当 $k\mid T$ 时，$d&#x3D;\frac{T}{k}$。所以就化为了这个式子。</p>
<p>这个式子可以直接预处理出 $\displaystyle\sum_{k\mid T\land k\in prime}\mu(\frac{T}{k})$，只需要枚举每个质数 $k$ 的倍数就行了，然后就可以二元数论分块。</p>
<h4 id="Code-6"><a href="#Code-6" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k : p)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> d = <span class="number">1</span>; d * k &lt;= n; d++)</span><br><span class="line">            sum[d * k] += mu[d];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] += sum[i - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">Euler</span>(n);</span><br><span class="line">    <span class="built_in">initival</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (sum[r] - sum[l - <span class="number">1</span>]) * (n / l) * (m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-3"><a href="#Question-3" class="headerlink" title="Question 3"></a>Question 3</h3><h4 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;a}^{b}\displaystyle\sum_{j&#x3D;c}^{d}[\gcd(i,j)&#x3D;k]<br>$$</p>
<h4 id="证明-3"><a href="#证明-3" class="headerlink" title="证明"></a>证明</h4><p>主要说如何拆这个 $\sum$，然后就是 $\operatorname{Problem 1}$ 了，为了方便书写，只考虑如何拆 $\sum$，证明省去了限制条件。</p>
<p>记 $f(n,m)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\operatorname{limit}]$。</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;a}^{b}\displaystyle\sum_{j&#x3D;c}^{d}<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;a}^{b}\displaystyle\sum_{j&#x3D;1}^{d}-\displaystyle\sum_{i&#x3D;a}^{b}\displaystyle\sum_{j&#x3D;1}^{c-1}\<br>&amp;&#x3D;(\displaystyle\sum_{i&#x3D;1}^{b}\displaystyle\sum_{j&#x3D;1}^{d}-\displaystyle\sum_{i&#x3D;1}^{a-1}\displaystyle\sum_{j&#x3D;1}^{d})-(\displaystyle\sum_{i&#x3D;1}^{b}\displaystyle\sum_{j&#x3D;1}^{c-1}-\displaystyle\sum_{i&#x3D;1}^{a-1}\displaystyle\sum_{j&#x3D;1}^{c-1})\<br>&amp;&#x3D;(f(b,d)-f(a-1,d))-(f(b,c-1)-f(a-1,c-1))\<br>\end{aligned}<br>$$</p>
<p>然后把 $f(n,m)$ 换成 $\operatorname{Problem 1}$ 就解决了。</p>
<h4 id="Code-7"><a href="#Code-7" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> a, b, c, d, k;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + mu[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    n /= k, m /= k;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; m)</span><br><span class="line">        <span class="built_in">swap</span>(n, m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (sum[r] - sum[l - <span class="number">1</span>]) * (n / l) * (m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b &gt;&gt; c &gt;&gt; d &gt;&gt; k;</span><br><span class="line">    <span class="built_in">Euler</span>(<span class="built_in">max</span>(b / k, d / k));</span><br><span class="line">    <span class="built_in">initival</span>(<span class="built_in">max</span>(b / k, d / k));</span><br><span class="line">    cout &lt;&lt; (<span class="built_in">f</span>(b, d) - <span class="built_in">f</span>(a - <span class="number">1</span>, d)) - (<span class="built_in">f</span>(b, c - <span class="number">1</span>) - <span class="built_in">f</span>(a - <span class="number">1</span>, c - <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-4"><a href="#Question-4" class="headerlink" title="Question 4"></a>Question 4</h3><h4 id="题目-4"><a href="#题目-4" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\gcd(i,j)<br>$$</p>
<h4 id="证明-4"><a href="#证明-4" class="headerlink" title="证明"></a>证明</h4><p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\gcd(i,j)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{d\mid \gcd(i,j)}\varphi(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\varphi(d)\displaystyle\sum_{i&#x3D;1}^{n}[d\mid i]\displaystyle\sum_{j&#x3D;1}^{m}[d\mid j]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\varphi(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}1\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\varphi(d)\lfloor\frac{n}{d}\rfloor\lfloor\frac{m}{d}\rfloor\<br>\end{aligned}<br>$$</p>
<p>发现跟 $\operatorname{Problem 1}$ 区别不大，只是将 $\mu$ 改为了 $\varphi$，仍然二元数论分块和预处理前缀和。</p>
<h4 id="Code-8"><a href="#Code-8" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> phi[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                phi[i * p[j]] = phi[i] * p[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            phi[i * p[j]] = phi[i] * (p[j] - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + phi[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">Euler</span>(n);</span><br><span class="line">    <span class="built_in">initival</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (sum[r] - sum[l - <span class="number">1</span>]) * (n / l) * (m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-5"><a href="#Question-5" class="headerlink" title="Question 5"></a>Question 5</h3><h4 id="题目-5"><a href="#题目-5" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\operatorname{lcm(i,j)}<br>$$</p>
<h4 id="证明-5"><a href="#证明-5" class="headerlink" title="证明"></a>证明</h4><p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\operatorname{lcm(i,j)}<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\frac{ij}{\gcd(i,j)}\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{d\mid i\land d\mid j}[\gcd(\frac{i}{d},\frac{j}{d})&#x3D;1]\frac{ij}{d}\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[\gcd(\frac{id}{d},\frac{jd}{d})&#x3D;1]\frac{id\times jd}{d}\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[\gcd(i,j)&#x3D;1]ij\<br>\end{aligned}<br>$$</p>
<p>设 $f(n,m)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}ij$，发现后半部分可以 $O(1)$ 求：</p>
<p>$$<br>\begin{aligned}<br>f(n,m)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}ij\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}i\times\displaystyle\sum_{j&#x3D;1}^{m}j\<br>&amp;&#x3D;\frac{n\times(n+1)}{2}\times\frac{m\times(m+1)}{2}\<br>\end{aligned}<br>$$</p>
<p>设 $g(n,m)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;1]\times ij$，发现这一部分可以数论分块：</p>
<p>$$<br>\begin{aligned}<br>g(n,m)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;1]\times ij\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}1\times id\times jd\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)d^2\times f(\lfloor\frac{n}{d}\rfloor,\lfloor\frac{m}{d}\rfloor)<br>\end{aligned}<br>$$</p>
<p>最后换元，发现数论分块套数论分块：</p>
<p>$$<br>\displaystyle\sum_{d&#x3D;1}^{n}d\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[\gcd(i,j)&#x3D;1]ij&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d\times g(\lfloor\frac{n}{d}\rfloor,\lfloor\frac{m}{d}\rfloor)<br>$$</p>
<h4 id="Code-9"><a href="#Code-9" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + i * i * mu[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">h</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> <span class="comment">// 等差数列求和</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x + y) * (y - x + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span> <span class="comment">// 证明中的 f 函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">h</span>(<span class="number">1</span>, n) * <span class="built_in">h</span>(<span class="number">1</span>, m);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">g</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span> <span class="comment">// 证明中的 g 函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; m)</span><br><span class="line">        <span class="built_in">swap</span>(n, m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (sum[r] - sum[l - <span class="number">1</span>]) * <span class="built_in">f</span>(n / l, m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">Euler</span>(n);</span><br><span class="line">    <span class="built_in">initival</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += <span class="built_in">h</span>(l, r) * <span class="built_in">g</span>(n / l, m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-6"><a href="#Question-6" class="headerlink" title="Question 6"></a>Question 6</h3><h4 id="题目-6"><a href="#题目-6" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\tau(ij)<br>$$</p>
<p>$\tau(n)$ 为 $n$ 的约数个数。</p>
<h4 id="证明-6"><a href="#证明-6" class="headerlink" title="证明"></a>证明</h4><p>前置：</p>
<p><del>说白了，我不会写这个前置的证明。</del></p>
<p>$$<br>\alpha(ij)&#x3D;\displaystyle\sum_{x\mid i}\displaystyle\sum_{y\mid j}[\gcd(x,y)&#x3D;1]<br>$$</p>
<p>愉快的代入：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\alpha(ij)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{x\mid i}\displaystyle\sum_{y\mid j}[\gcd(x,y)&#x3D;1]\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{x\mid i}\displaystyle\sum_{y\mid j}\displaystyle\sum_{d\mid \gcd(x,y)}\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{x&#x3D;1}^{i}[x\mid i]\displaystyle\sum_{y&#x3D;1}^{j}[y\mid j][d\mid \gcd(x,y)]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{x&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{n}[x\mid i]\displaystyle\sum_{y&#x3D;1}^{m}\displaystyle\sum_{j&#x3D;1}^{m}[y\mid j][d\mid \gcd(x,y)]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{x&#x3D;1}^{n}\displaystyle\sum_{y&#x3D;1}^{m}[d\mid \gcd(x,y)]\lfloor\frac{n}{x}\rfloor\lfloor\frac{m}{y}\rfloor\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{x&#x3D;1}^{n}[d\mid x]\displaystyle\sum_{y&#x3D;1}^{m}[d\mid y]\lfloor\frac{n}{x}\rfloor\lfloor\frac{m}{y}\rfloor\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{x&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{y&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\lfloor\frac{n}{xd}\rfloor\lfloor\frac{m}{yd}\rfloor\<br>\end{aligned}<br>$$</p>
<p>设 $f(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\lfloor\frac{n}{i}\rfloor$</p>
<p>换元代入：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{x&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{y&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\lfloor\frac{n}{xd}\rfloor\lfloor\frac{m}{yd}\rfloor<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)f(\lfloor\frac{n}{d}\rfloor)f(\lfloor\frac{m}{d}\rfloor)<br>\end{aligned}<br>$$</p>
<p>数论分块就好了，对于 $f$ 函数，如果超时了可以记忆化，因为 $n\leqslant 50000$。</p>
<h4 id="Code-10"><a href="#Code-10" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + mu[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">f</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans += (r - l + <span class="number">1</span>) * (n / l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">Euler</span>(n);</span><br><span class="line">    <span class="built_in">initival</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (sum[r] - sum[l - <span class="number">1</span>]) * <span class="built_in">f</span>(n / l) * <span class="built_in">f</span>(m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-7"><a href="#Question-7" class="headerlink" title="Question 7"></a>Question 7</h3><h4 id="题目-7"><a href="#题目-7" class="headerlink" title="题目"></a>题目</h4><p>$$<br>(\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}ij\gcd(i,j))\bmod,p<br>$$</p>
<p>$n\leqslant 10^{10}$，注意数据范围</p>
<h4 id="证明-7"><a href="#证明-7" class="headerlink" title="证明"></a>证明</h4><p>为了证明方便，略去取模。</p>
<h5 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h5><p>一些显然的式子：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}i&amp;&#x3D;\frac{n\times(n+1)}{2}\<br>\displaystyle\sum_{i&#x3D;1}^{n}i^2&amp;&#x3D;\frac{n\times(n+1)\times(2\times n+1)}{6}\<br>\displaystyle\sum_{i&#x3D;1}^{n}i^3&amp;&#x3D;\frac{n^2\times(n+1)^2}{4}\<br>\end{aligned}<br>$$</p>
<p>杜教筛：</p>
<p>设 $f(n)$ 为要求的函数，$g(n)$ 为参与卷积的函数，$S(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}f(i)$。</p>
<p>证明：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}(f*g)(i)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{d\mid i}f(d)*g(\frac{n}{d})\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{d\mid i}f(\frac{n}{d})*g(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{n}[d\mid i]f(\frac{i}{d})*g(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}g(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}f(\frac{i\times d}{d})\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}g(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}f(i)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}g(d)S(\lfloor\frac{n}{d}\rfloor)\<br>\end{aligned}<br>$$</p>
<p>然后考虑 $g(1)S(n)$ 如何求：</p>
<p>$$<br>\begin{aligned}<br>g(1)S(n)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}g(i)S(\lfloor\frac{n}{i}\rfloor)-\displaystyle\sum_{i&#x3D;2}^{n}g(i)S(\lfloor\frac{n}{i}\rfloor)\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}(f*g)(i)-\displaystyle\sum_{i&#x3D;2}^{n}g(i)S(\lfloor\frac{n}{i}\rfloor)<br>\end{aligned}<br>$$</p>
<p>结论通式：</p>
<p>$$<br>g(1)S(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}(f*g)(i)-\displaystyle\sum_{i&#x3D;2}^{n}g(i)\times S(\lfloor\frac{n}{i}\rfloor)<br>$$</p>
<h5 id="mu-反演"><a href="#mu-反演" class="headerlink" title="$\mu$ 反演"></a>$\mu$ 反演</h5><p>类比 $\operatorname{Problem 5}$，直接将 $\gcd(i,j)$ 替换：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}ij\gcd(i,j)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}ij\displaystyle\sum_{d\mid i\land d\mid j}d[\gcd(i,j)&#x3D;d]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}ij[\gcd(i,j)&#x3D;d]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d\displaystyle\sum_{i&#x3D;1}^{n}[d\mid i]\displaystyle\sum_{j&#x3D;1}^{n}[d\mid j]ij[\gcd(i,j)&#x3D;d]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}id\times jd[\gcd(id,jd)&#x3D;d]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d^3\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}[\gcd(i,j)&#x3D;1]\times ij<br>\end{aligned}<br>$$</p>
<p>$f,g$ 证明同 $\operatorname{Problem 5}$，不再赘述，然后仍然设：</p>
<p>$f(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}ij&#x3D;(\frac{n\times(n+1)}{2})^2$。</p>
<p>$g(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}[\gcd(i,j)&#x3D;1]\times ij&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)d^2\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}ij&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)d^2\times f(\lfloor\frac{n}{d}\rfloor)$。</p>
<p>最后换元：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{d&#x3D;1}^{n}d^3\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}[\gcd(i,j)&#x3D;1]\times ij<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d^3\times g(\lfloor\frac{n}{d}\rfloor)<br>\end{aligned}<br>$$</p>
<p>现在证明另一部分，杜教筛：</p>
<p>对于 $\mu$ 反演的证明，瓶颈在于 $\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)d^2$，由于 $n$ 很大，无法线性筛，考虑杜教筛：</p>
<p>设：</p>
<p>$$<br>\begin{aligned}<br>f(n)&amp;&#x3D;n^2\mu(n)\<br>g(n)&amp;&#x3D;n^2\<br>S(n)&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}f(i)\<br>g(1)&amp;&#x3D;1^2&#x3D;1\<br>\end{aligned}<br>$$</p>
<p>化简 $(f*g)(n)$</p>
<p>$$<br>\begin{aligned}<br>(f*g)(n)<br>&amp;&#x3D;\displaystyle\sum_{d\mid n}f(d)<em>g(\frac{n}{d})\<br>&amp;&#x3D;\displaystyle\sum_{d\mid n}d^2\mu(d)\times \frac{n^2}{d^2}\<br>&amp;&#x3D;n^2\displaystyle\sum_{d\mid n}\mu(d)\<br>&amp;&#x3D;n^2(\mu</em>1)(n)\<br>&amp;&#x3D;n^2\varepsilon(n)\<br>\end{aligned}<br>$$</p>
<p>代入通式：</p>
<p>$$<br>S(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}i^2\varepsilon(i)-\displaystyle\sum_{i&#x3D;2}^{n}i^2\times S(\lfloor\frac{n}{i}\rfloor)&#x3D;1-\displaystyle\sum_{i&#x3D;2}^{n}i^2\times S(\lfloor\frac{n}{i}\rfloor)<br>$$</p>
<p>此时发现 $S(n)$ 可以用杜教筛数论分块求了。</p>
<p>然而很不幸，加上杜教筛，时间复杂度太高，不能通过。</p>
<h5 id="varphi-反演"><a href="#varphi-反演" class="headerlink" title="$\varphi$ 反演"></a>$\varphi$ 反演</h5><p>根据 $\displaystyle\sum_{d\mid \gcd(i,j)}\varphi(d)&#x3D;\gcd(i,j)$ 直接替换：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}ij\gcd(i,j)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}\displaystyle\sum_{d\mid \gcd(i,j)}\varphi(d)ij\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\varphi(d)id\times jd\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d^2\varphi(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}ij\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d^2\varphi(d)\times f(\lfloor\frac{n}{d}\rfloor)<br>\end{aligned}<br>$$</p>
<p>同样，瓶颈在于 $\displaystyle\sum_{d&#x3D;1}^{n}d^2\varphi(d)$，考虑杜教筛：</p>
<p>设：</p>
<p>$$<br>\begin{aligned}<br>f(n)&amp;&#x3D;n^2\varphi(n)\<br>g(n)&amp;&#x3D;n^2\<br>S(n)&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}f(i)\<br>g(1)&amp;&#x3D;1^2&#x3D;1\<br>\end{aligned}<br>$$</p>
<p>化简 $(f*g)(n)$</p>
<p>$$<br>\begin{aligned}<br>(f*g)(n)<br>&amp;&#x3D;\displaystyle\sum_{d\mid n}f(d)<em>g(\frac{n}{d})\<br>&amp;&#x3D;\displaystyle\sum_{d\mid n}d^2\varphi(d)\times \frac{n^2}{d^2}\<br>&amp;&#x3D;n^2\displaystyle\sum_{d\mid n}\varphi(d)\<br>&amp;&#x3D;n^2(\varphi</em>1)(n)\<br>&amp;&#x3D;n^2\operatorname{id}(n)\<br>&amp;&#x3D;n^3\<br>\end{aligned}<br>$$</p>
<p>代入通式：</p>
<p>$$<br>S(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}i^3-\displaystyle\sum_{i&#x3D;2}^{n}i^2\times S(\lfloor\frac{n}{i}\rfloor)&#x3D;\frac{n^2\times(n+1)^2}{4}-\displaystyle\sum_{i&#x3D;2}^{n}i^2\times S(\lfloor\frac{n}{i}\rfloor)<br>$$</p>
<p>和 $\mu$ 差不多，此时发现 $S(n)$ 可以用杜教筛数论分块求了。</p>
<h4 id="Code-11"><a href="#Code-11" class="headerlink" title="Code"></a>Code</h4><p>$\mu$ 反演：很不幸，一部分测试点 $\operatorname{TLE}$ 了，但是思路是对的，时间复杂度不太对：数论分块套数论分块，内层再套个杜教筛。(555)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="type">int</span> inv2, inv4, inv6;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e7</span> + <span class="number">5</span>;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line">bitset&lt;N&gt; vis;</span><br><span class="line"><span class="type">int</span> ans;</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line">ll n;</span><br><span class="line">unordered_map&lt;ll,<span class="type">int</span>&gt; mp;</span><br><span class="line"><span class="keyword">namespace</span> calc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> MOD;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x+y&gt;=MOD?x+y-MOD:x+y;&#125; <span class="comment">// +</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x&lt;y?x-y+MOD:x-y;&#125;      <span class="comment">// -</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> (ll)x*y%MOD;&#125;          <span class="comment">// *</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mod</span><span class="params">(ll x)</span></span>&#123;<span class="keyword">return</span> x&gt;=MOD?x%MOD:x;&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Add</span>(<span class="built_in">Add</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Red</span>(<span class="built_in">Red</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Mul</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Ksm</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> ans=<span class="number">1</span>)</span></span>&#123;<span class="keyword">while</span>(y&gt;<span class="number">0</span>)&#123;<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=<span class="built_in">Mul</span>(ans,x);x=<span class="built_in">Mul</span>(x,x);y&gt;&gt;=<span class="number">1</span>;&#125;<span class="keyword">return</span> ans;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Inv</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Ksm</span>(x,MOD<span class="number">-2</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> calc;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; (ll)i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = <span class="built_in">Add</span>(sum[i - <span class="number">1</span>], <span class="built_in">Mul</span>(i, i, <span class="built_in">Add</span>(MOD, mu[i])));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">h3</span><span class="params">(ll x, ll y)</span> <span class="comment">// [x-&gt;y](sum i^3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Red</span>(<span class="built_in">Mul</span>(<span class="built_in">Mod</span>(y), <span class="built_in">Mod</span>(y), <span class="built_in">Mod</span>(y + <span class="number">1</span>), <span class="built_in">Mod</span>(y + <span class="number">1</span>)), <span class="built_in">Mul</span>(<span class="built_in">Mod</span>(x), <span class="built_in">Mod</span>(x), <span class="built_in">Mod</span>(x - <span class="number">1</span>), <span class="built_in">Mod</span>(x - <span class="number">1</span>))), inv4);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">h2</span><span class="params">(ll x, ll y)</span> <span class="comment">// [x-&gt;y](sum i^2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Red</span>(<span class="built_in">Mul</span>(<span class="built_in">Mod</span>(y), <span class="built_in">Mod</span>(y + <span class="number">1</span>), <span class="built_in">Mod</span>(<span class="number">2</span> * y + <span class="number">1</span>)), <span class="built_in">Mul</span>(<span class="built_in">Mod</span>(x - <span class="number">1</span>), <span class="built_in">Mod</span>(x), <span class="built_in">Mod</span>(<span class="number">2ll</span> * x - <span class="number">1</span>))), inv6);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">h1</span><span class="params">(ll x, ll y)</span> <span class="comment">// [x-&gt;y](sum i^1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Mod</span>(x + y), <span class="built_in">Mod</span>(y - x + <span class="number">1</span>), inv2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_sum</span><span class="params">(ll n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; N)</span><br><span class="line">        <span class="keyword">return</span> sum[n];</span><br><span class="line">    <span class="keyword">if</span>(mp.<span class="built_in">count</span>(n))</span><br><span class="line">        <span class="keyword">return</span> mp[n];</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (ll l = <span class="number">2</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans = <span class="built_in">Red</span>(ans, <span class="built_in">Mul</span>(<span class="built_in">h2</span>(l, r), <span class="built_in">get_sum</span>(n / l)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mp[n] = ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">f</span><span class="params">(ll n)</span> <span class="comment">// 证明中的 f 函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">h1</span>(<span class="number">1</span>, n), <span class="built_in">h1</span>(<span class="number">1</span>, n));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">g</span><span class="params">(ll n)</span> <span class="comment">// 证明中的 g 函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (ll l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans = <span class="built_in">Add</span>(ans, <span class="built_in">Mul</span>(<span class="built_in">Red</span>(<span class="built_in">get_sum</span>(r), <span class="built_in">get_sum</span>(l - <span class="number">1</span>)), <span class="built_in">f</span>(n / l)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; MOD &gt;&gt; n;</span><br><span class="line">    inv2 = <span class="built_in">Inv</span>(<span class="number">2</span>);</span><br><span class="line">    inv4 = <span class="built_in">Inv</span>(<span class="number">4</span>);</span><br><span class="line">    inv6 = <span class="built_in">Inv</span>(<span class="number">6</span>);</span><br><span class="line">    <span class="built_in">Euler</span>(N - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">initival</span>(N - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (ll l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans = <span class="built_in">Add</span>(ans, <span class="built_in">Mul</span>(<span class="built_in">h3</span>(l, r), <span class="built_in">g</span>(n / l)));</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>$\varphi$ 反演：时间复杂度正确。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="type">int</span> inv2, inv4, inv6;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e7</span> + <span class="number">5</span>;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line">bitset&lt;N&gt; vis;</span><br><span class="line"><span class="type">int</span> ans;</span><br><span class="line"><span class="type">int</span> phi[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line">ll n;</span><br><span class="line">unordered_map&lt;ll, <span class="type">int</span>&gt; mp;</span><br><span class="line"><span class="keyword">namespace</span> calc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> MOD;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x+y&gt;=MOD?x+y-MOD:x+y;&#125; <span class="comment">// +</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x&lt;y?x-y+MOD:x-y;&#125;      <span class="comment">// -</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> (ll)x*y%MOD;&#125;          <span class="comment">// *</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mod</span><span class="params">(ll x)</span></span>&#123;<span class="keyword">return</span> x&gt;=MOD?x%MOD:x;&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Add</span>(<span class="built_in">Add</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Red</span>(<span class="built_in">Red</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Mul</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Ksm</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> ans=<span class="number">1</span>)</span></span>&#123;<span class="keyword">while</span>(y&gt;<span class="number">0</span>)&#123;<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=<span class="built_in">Mul</span>(ans,x);x=<span class="built_in">Mul</span>(x,x);y&gt;&gt;=<span class="number">1</span>;&#125;<span class="keyword">return</span> ans;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Inv</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Ksm</span>(x,MOD<span class="number">-2</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> calc;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; (ll)i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                phi[i * p[j]] = phi[i] * p[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            phi[i * p[j]] = phi[i] * (p[j] - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = <span class="built_in">Add</span>(sum[i - <span class="number">1</span>], <span class="built_in">Mul</span>(i, i, <span class="built_in">Add</span>(MOD, phi[i])));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">h3</span><span class="params">(ll x, ll y)</span> <span class="comment">// [x-&gt;y](sum i^3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Red</span>(<span class="built_in">Mul</span>(<span class="built_in">Mod</span>(y), <span class="built_in">Mod</span>(y), <span class="built_in">Mod</span>(y + <span class="number">1</span>), <span class="built_in">Mod</span>(y + <span class="number">1</span>)), <span class="built_in">Mul</span>(<span class="built_in">Mod</span>(x), <span class="built_in">Mod</span>(x), <span class="built_in">Mod</span>(x - <span class="number">1</span>), <span class="built_in">Mod</span>(x - <span class="number">1</span>))), inv4);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">h2</span><span class="params">(ll x, ll y)</span> <span class="comment">// [x-&gt;y](sum i^2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Red</span>(<span class="built_in">Mul</span>(<span class="built_in">Mod</span>(y), <span class="built_in">Mod</span>(y + <span class="number">1</span>), <span class="built_in">Mod</span>(<span class="number">2</span> * y + <span class="number">1</span>)), <span class="built_in">Mul</span>(<span class="built_in">Mod</span>(x - <span class="number">1</span>), <span class="built_in">Mod</span>(x), <span class="built_in">Mod</span>(<span class="number">2ll</span> * x - <span class="number">1</span>))), inv6);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">h1</span><span class="params">(ll x, ll y)</span> <span class="comment">// [x-&gt;y](sum i^1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Mod</span>(x + y), <span class="built_in">Mod</span>(y - x + <span class="number">1</span>), inv2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get_sum</span><span class="params">(ll n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; N)</span><br><span class="line">        <span class="keyword">return</span> sum[n];</span><br><span class="line">    <span class="keyword">if</span> (mp.<span class="built_in">count</span>(n))</span><br><span class="line">        <span class="keyword">return</span> mp[n];</span><br><span class="line">    <span class="type">int</span> ans = <span class="built_in">h3</span>(<span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (ll l = <span class="number">2</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans = <span class="built_in">Red</span>(ans, <span class="built_in">Mul</span>(<span class="built_in">h2</span>(l, r), <span class="built_in">get_sum</span>(n / l)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mp[n] = ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; MOD &gt;&gt; n;</span><br><span class="line">    inv2 = <span class="built_in">Inv</span>(<span class="number">2</span>);</span><br><span class="line">    inv4 = <span class="built_in">Inv</span>(<span class="number">4</span>);</span><br><span class="line">    inv6 = <span class="built_in">Inv</span>(<span class="number">6</span>);</span><br><span class="line">    <span class="built_in">Euler</span>(N - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">initival</span>(N - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (ll l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans = <span class="built_in">Add</span>(ans, <span class="built_in">Mul</span>(<span class="built_in">Red</span>(<span class="built_in">get_sum</span>(r), <span class="built_in">get_sum</span>(l - <span class="number">1</span>)), <span class="built_in">h3</span>(<span class="number">1</span>, n / l)));</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-8"><a href="#Question-8" class="headerlink" title="Question 8"></a>Question 8</h3><h4 id="题目-8"><a href="#题目-8" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\gcd(i,j)^k<br>$$</p>
<h4 id="证明-8"><a href="#证明-8" class="headerlink" title="证明"></a>证明</h4><p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\gcd(i,j)^k<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d^k\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;d]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d^k\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[\gcd(i,j)&#x3D;1]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d^k\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\displaystyle\sum_{s\mid \gcd(i,j)}\mu(s)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d^k\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\lfloor\frac{n}{ds}\rfloor\lfloor\frac{m}{ds}\rfloor\<br>\end{aligned}<br>$$</p>
<p>换元 $T&#x3D;ds$ 与 $\operatorname{Problem 2}$ 类似。</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{d&#x3D;1}^{n}d^k\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\lfloor\frac{n}{ds}\rfloor\lfloor\frac{m}{ds}\rfloor<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d^k\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\lfloor\frac{n}{T}\rfloor\lfloor\frac{m}{T}\rfloor\<br>&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{n}\lfloor\frac{n}{T}\rfloor\lfloor\frac{m}{T}\rfloor\displaystyle\sum_{d\mid T}d^k\mu(\frac{T}{d})<br>\end{aligned}<br>$$</p>
<p>预处理是枚举 $d$ 的倍数，但是时间复杂度 $\displaystyle\sum_{i&#x3D;1}^{n}\frac{n}{i}&#x3D;n\ln n,(n\leqslant 5\times 10^6)$，时间复杂度 $O(n\ln n)$ 不能接受。</p>
<p>考虑如何快速处理 $\displaystyle\sum_{d\mid T}d^k\mu(\frac{T}{d})$：</p>
<p>先化为狄利克雷卷积的形式：设 $f(n)&#x3D;(\operatorname{id_k}*\mu)(n)&#x3D;\displaystyle\sum_{d\mid n}d^k\mu(\frac{n}{d})$，发现 $f(n)$ 即为所求。</p>
<p>因为 $\operatorname{id_k},\mu$，所以根据狄利克雷卷积的性质，$f$ 也是积性函数，又根据唯一分解定理，所以得到：</p>
<p>$$<br>\begin{aligned}<br>f(n)&#x3D;\displaystyle\prod_{i&#x3D;1}f(p_i^{s_i})<br>\end{aligned}<br>$$</p>
<p>考虑 $f(p_i^{k_i})$：</p>
<p>$$<br>\begin{aligned}<br>f(p_i^{s_i})&#x3D;\displaystyle\sum_{d\mid p_i^{s_i}}d^k\mu(\frac{p_i^{s_i}}{d})<br>\end{aligned}<br>$$</p>
<p>根据 $\mu$ 的性质：</p>
<p>$$<br>\begin{aligned}<br>\mu(\frac{p_i^{s_i}}{d})&#x3D;<br>\begin{cases}<br>d&#x3D;p_i^{s_i}&amp;\implies\mu(1)&#x3D;1\<br>d&#x3D;p_i^{s_i-1}&amp;\implies\mu(p_i)&#x3D;-1\<br>d&#x3D;p_i^{[0,s_i-1)}&amp;\implies\mu(p_i^{x})&#x3D;0,(x\gt1)\<br>\end{cases}<br>\end{aligned}<br>$$</p>
<p>所以发现：</p>
<p>$$<br>\begin{aligned}<br>f(p_i^{s_i})<br>&amp;&#x3D;\displaystyle\sum_{d\mid p_i^{s_i}}d^k\mu(\frac{p_i^{s_i}}{d})\<br>&amp;&#x3D;{p_i^{s_i\times k}}\mu(1)+{p_i^{(s_i-1)\times k}}\mu(p_i)\<br>&amp;&#x3D;{p_i^{s_i\times k}}-{p_i^{(s_i-1)\times k}}\<br>&amp;&#x3D;{p_i^{(s_i-1)\times k}}\times(p_i^k-1)\\<br>\because f(p_i^{s_i-1})&amp;&#x3D;{p_i^{(s_i-2)\times k}}\times(p_i^k-1)\qquad s_i\gt1\<br>\therefore f(p_i^{s_i})&amp;&#x3D;<br>\begin{cases}<br>f(p_i^{s_i-1})\times p_i^k&amp;s_i\gt1\<br>p_i^k-1&amp;s_i&#x3D;1<br>\end{cases}<br>\end{aligned}<br>$$</p>
<p>所以在欧拉筛的过程中，当前已知 $f(i)$，要求 $f(i\times p)$：</p>
<p>$$<br>\begin{aligned}<br>f(i)&amp;&#x3D;i^k-1\qquad&amp;i\in prime\<br>f(i\times p)&amp;&#x3D;f(i)\times p^k\qquad&amp;[p\mid i]\<br>f(i\times p)&amp;&#x3D;f(i)\times f(p)\qquad&amp;[p\nmid i]\<br>\end{aligned}<br>$$</p>
<h4 id="Code-12"><a href="#Code-12" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, k, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    f[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            f[i] = <span class="built_in">pow</span>(i, k) - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                f[i * p[j]] = f[i] * <span class="built_in">pow</span>(p[j], k);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            f[i * p[j]] = f[i] * f[p[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + f[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    <span class="built_in">Euler</span>(n);</span><br><span class="line">    <span class="built_in">initival</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (sum[r] - sum[l - <span class="number">1</span>]) * (n / l) * (m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-9"><a href="#Question-9" class="headerlink" title="Question 9"></a>Question 9</h3><h4 id="题目-9"><a href="#题目-9" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\tau(i)\tau(j)\tau(\gcd(i,j))<br>$$</p>
<h4 id="证明-9"><a href="#证明-9" class="headerlink" title="证明"></a>证明</h4><p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\tau(i)\tau(j)\tau(\gcd(i,j))<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\tau(d)\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\tau(i)\tau(j)[\gcd(i,j)&#x3D;d]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\tau(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\tau(id)\tau(jd)[\gcd(i,j)&#x3D;1]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\tau(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\tau(id)\tau(jd)\displaystyle\sum_{s\mid \gcd(i,j)}\mu(s)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\tau(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{ds}\rfloor}\tau(ids)\tau(jds)\<br>\end{aligned}<br>$$</p>
<p>换元 $T&#x3D;ds$：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{d&#x3D;1}^{n}\tau(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{ds}\rfloor}\tau(ids)\tau(jds)<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\tau(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{T}\rfloor}\tau(iT)\tau(jT)\<br>&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{n}\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{d\mid T}\mu(\frac{T}{d})\tau(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{T}\rfloor}\tau(iT)\tau(jT)<br>\end{aligned}<br>$$</p>
<p>因为有 $\mu<em>\tau&#x3D;1$，所以得到：$\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{d\mid T}\mu(\frac{T}{d})\tau(d)&#x3D;(\mu</em>\tau)(T)&#x3D;1(T)&#x3D;1$。</p>
<p>然后得到这个式子：$\displaystyle\sum_{T&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\tau(iT)\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{T}\rfloor}\tau(jT)$。</p>
<p>因为数据弱单组测试且 $n,m\leqslant 2\times 10^6$ 直接线性筛 $\tau$ 预处理前缀和就行了，时间复杂度 $(n\ln n)$，可以通过。</p>
<p>数据加强时可以用狄利克雷卷积后缀和优化，但是我不会<del>（逃……）</del>。</p>
<h4 id="Code-13"><a href="#Code-13" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="type">int</span> g[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, k, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    f[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    g[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            g[i] = <span class="number">1</span>;</span><br><span class="line">            f[i] = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                g[i * p[j]] = g[i] + <span class="number">1</span>;</span><br><span class="line">                f[i * p[j]] = f[i] / (g[i] + <span class="number">1</span>) * (g[i * p[j]] + <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            g[i * p[j]] = <span class="number">1</span>;</span><br><span class="line">            f[i * p[j]] = f[i] * f[p[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; i * j &lt;= n; j++)</span><br><span class="line">        sum[j] = (sum[j - <span class="number">1</span>] + f[i * j]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">Euler</span>(<span class="built_in">max</span>(n, m));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="built_in">min</span>(n, m); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">initival</span>(i, <span class="built_in">max</span>(n, m));</span><br><span class="line">        ans += sum[n / i] * sum[m / i];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本题的狄利克雷卷积后缀和优化参考代码，时间复杂度 $O(n\log\log n)$：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(sumn, f, <span class="built_in">sizeof</span>(sumn));</span><br><span class="line">    <span class="built_in">memcpy</span>(summ, f, <span class="built_in">sizeof</span>(summ));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k : p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n / k; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            sumn[i] += sumn[i * k];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = m / k; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            summ[i] += summ[i * k];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">Euler</span>(<span class="built_in">max</span>(n, m));</span><br><span class="line">    <span class="built_in">initival</span>(n, m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="built_in">min</span>(n, m); i++)</span><br><span class="line">        ans += sumn[i] * summ[i];</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-10"><a href="#Question-10" class="headerlink" title="Question 10"></a>Question 10</h3><h4 id="题目-10"><a href="#题目-10" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{d\mid i\land d\mid j}d[\displaystyle\sum_{d\mid i\land d\mid j}d\leqslant a]<br>$$</p>
<h4 id="证明-10"><a href="#证明-10" class="headerlink" title="证明"></a>证明</h4><p>首先：$[d\mid i\land d\mid j]\iff [d\mid \gcd(i,j)]$。</p>
<p>设：$\sigma(n)$ 为 $n$ 的约数个数和。</p>
<p>先忽略 $[\displaystyle\sum_{d\mid i\land d\mid j}d\leqslant a]$ 这个限制。</p>
<p>首先这个证明行不通，因为无法处理限制：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{d\mid i\land d\mid j}d<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{n}[d\mid i]\displaystyle\sum_{j&#x3D;1}^{m}[d\mid j]d\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}d\lfloor\frac{n}{d}\rfloor\lfloor\frac{m}{d}\rfloor<br>\end{aligned}<br>$$</p>
<p>换一个思路：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\displaystyle\sum_{d\mid i\land d\mid j}d<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\sigma(\gcd(i,j))\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\sigma(d)\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;d]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\sigma(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[\gcd(i,j)&#x3D;1]\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\sigma(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\displaystyle\sum_{s\mid\gcd(i,j)}\mu(s)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\sigma(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\lfloor\frac{n}{ds}\rfloor\lfloor\frac{m}{ds}\rfloor\<br>\end{aligned}<br>$$</p>
<p>还是设 $T&#x3D;ds$：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{d&#x3D;1}^{n}\sigma(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\lfloor\frac{n}{ds}\rfloor\lfloor\frac{m}{ds}\rfloor<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\sigma(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\lfloor\frac{n}{T}\rfloor\lfloor\frac{m}{T}\rfloor\<br>&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{n}\lfloor\frac{n}{T}\rfloor\lfloor\frac{m}{T}\rfloor\displaystyle\sum_{d\mid T}\sigma(d)\mu(\frac{T}{d})<br>\end{aligned}<br>$$</p>
<p>式子化到这里其实就是要统计满足 $\sigma(n)\leqslant a$ 的贡献（$\sigma$ 可以线性筛）。然后解决这个问题。</p>
<ul>
<li><p>多组询问，$a$ 不相同：</p>
<p>  本题多组询问，所以可以先把询问离线下来按照 $a$ <strong>从小到大排序</strong>，这样贡献只增不减，动态维护 $\displaystyle\sum_{d\mid T}\sigma(d)\mu(\frac{T}{d})$ 前缀和。</p>
</li>
<li><p>动态维护 $\displaystyle\sum_{d\mid T}\sigma(d)\mu(\frac{T}{d})$ 前缀和：</p>
<p>  可以用树状数组维护。先线性筛出 $\sigma$，然后将 $\sigma$ 排序，因为询问时 $a$ 单调不减，这样每次处理一个询问之前先将 $\sigma(d)\leqslant a$ 的贡献通过暴力枚举 $d$ 的倍数更新前缀和，然后再数论分块处理。</p>
</li>
</ul>
<h4 id="Code-14"><a href="#Code-14" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line">bitset&lt;N&gt; vis;</span><br><span class="line"><span class="type">int</span> g[N];</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line">ll ans[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">type</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> type &amp;A, <span class="type">const</span> type &amp;B)&#123;<span class="keyword">return</span> A.x &gt; B.x;&#125;</span><br><span class="line">    <span class="built_in">type</span>(<span class="type">int</span> x = <span class="number">0</span>, <span class="type">int</span> y = <span class="number">0</span>) : <span class="built_in">x</span>(x), <span class="built_in">y</span>(y)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">vector&lt;type&gt; V;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">question</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> n, m, i, a;</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> question &amp;A, <span class="type">const</span> question &amp;B)&#123;<span class="keyword">return</span> A.a &lt; B.a;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">question q[N];</span><br><span class="line"><span class="keyword">namespace</span> BIT</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lowbit(x) ((+x) &amp; (-x))</span></span><br><span class="line">    ll tr[N];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (x &lt;= <span class="number">1e5</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            tr[x] += val;</span><br><span class="line">            x += <span class="built_in">lowbit</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ll ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ans += tr[x];</span><br><span class="line">            x -= <span class="built_in">lowbit</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i * d &lt;= <span class="number">1e5</span>; i++)</span><br><span class="line">            <span class="built_in">add</span>(i * d, f[d] * mu[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> BIT;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    g[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    f[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            g[i] = i + <span class="number">1</span>;</span><br><span class="line">            f[i] = i + <span class="number">1</span>;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                g[i * p[j]] = g[i] * p[j] + <span class="number">1</span>;</span><br><span class="line">                f[i * p[j]] = f[i] / g[i] * g[i * p[j]];</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            g[i * p[j]] = p[j] + <span class="number">1</span>;</span><br><span class="line">            f[i * p[j]] = f[i] * f[p[j]];</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        V.<span class="built_in">emplace_back</span>(<span class="built_in">type</span>(f[i], i));</span><br><span class="line">    <span class="built_in">sort</span>(V.<span class="built_in">begin</span>(), V.<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!V.<span class="built_in">empty</span>() &amp;&amp; V.<span class="built_in">rbegin</span>()-&gt;x &lt;= a)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">update</span>(V.<span class="built_in">rbegin</span>()-&gt;y);</span><br><span class="line">        V.<span class="built_in">pop_back</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= T; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; q[i].n &gt;&gt; q[i].m &gt;&gt; q[i].a;</span><br><span class="line">        q[i].i = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Euler</span>(<span class="number">1e5</span>);</span><br><span class="line">    <span class="built_in">sort</span>(q + <span class="number">1</span>, q + T + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= T; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> n = q[i].n;</span><br><span class="line">        <span class="type">int</span> m = q[i].m;</span><br><span class="line">        <span class="built_in">initival</span>(q[i].a);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">            ans[q[i].i] += (<span class="built_in">query</span>(r) - <span class="built_in">query</span>(l - <span class="number">1</span>)) * (n / l) * (m / l);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= T; i++)</span><br><span class="line">        cout &lt;&lt; ans[i] &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-11"><a href="#Question-11" class="headerlink" title="Question 11"></a>Question 11</h3><h4 id="题目-11"><a href="#题目-11" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{m}F_{\gcd(i,j)}<br>$$</p>
<p>$F_n$ 为 $\operatorname{Fibonacci}$ 数列第 $n$ 项。</p>
<h4 id="证明-11"><a href="#证明-11" class="headerlink" title="证明"></a>证明</h4><p>$$<br>\begin{aligned}<br>\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{m}F_{\gcd(i,j)}<br>&amp;&#x3D;\displaystyle\prod_{d&#x3D;1}^{n}F_d^{\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;d]}\<br>&amp;&#x3D;\displaystyle\prod_{d&#x3D;1}^{n}F_d^{\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[\gcd(i,j)&#x3D;1]}\<br>\end{aligned}<br>$$</p>
<p>设 $g(n,m)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;1]$，莫比乌斯反演套路式：</p>
<p>$$<br>g(n,m)&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\lfloor\frac{n}{d}\rfloor\lfloor\frac{m}{d}\rfloor<br>$$</p>
<p>换元代入：</p>
<p>$$<br>\displaystyle\prod_{d&#x3D;1}^{n}F_d^{\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[\gcd(i,j)&#x3D;1]}&#x3D;\displaystyle\prod_{d&#x3D;1}^{n}F_d^{g(\lfloor\frac{n}{d}\rfloor,\lfloor\frac{m}{d}\rfloor)}<br>$$</p>
<p>线性筛 $\mu$ 求前缀和然后直接暴力快速幂就可以了。</p>
<p>其实还有进一步优化空间，可以把时间复杂度优化到 $\sqrt n$，但是式子推到这里就可以通过了。</p>
<h4 id="Code-15"><a href="#Code-15" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">namespace</span> IO</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP&gt; <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">(TP &amp;n)</span></span>&#123;TP w=<span class="number">1</span>;<span class="type">char</span> x=<span class="built_in">getchar</span>();n=<span class="number">0</span>;<span class="keyword">while</span>(x&lt;<span class="string">&#x27;0&#x27;</span>||x&gt;<span class="string">&#x27;9&#x27;</span>)&#123;<span class="keyword">if</span>(x==<span class="string">&#x27;-&#x27;</span>)w=<span class="number">-1</span>;x=<span class="built_in">getchar</span>();&#125;<span class="keyword">while</span>(x&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;x&lt;=<span class="string">&#x27;9&#x27;</span>)&#123;n=(n&lt;&lt;<span class="number">1</span>)+(n&lt;&lt;<span class="number">3</span>)+(x^<span class="number">48</span>);x=<span class="built_in">getchar</span>();&#125;<span class="keyword">return</span> n*=w,<span class="number">1</span>;&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP&gt; <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">write</span><span class="params">(TP x)</span></span>&#123;<span class="keyword">if</span>(!x)<span class="keyword">return</span> <span class="built_in">putchar</span>(<span class="string">&#x27;0&#x27;</span>),<span class="number">1</span>;<span class="type">short</span> s[<span class="number">20</span>],top=<span class="number">0</span>;<span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>),x=-x;<span class="keyword">while</span>(x)&#123;s[++top]=x%<span class="number">10</span>;x/=<span class="number">10</span>;&#125;<span class="keyword">while</span>(top&gt;<span class="number">0</span>) <span class="built_in">putchar</span>(s[top--]+<span class="string">&#x27;0&#x27;</span>);<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP&gt; <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">write</span><span class="params">(TP n,<span class="type">char</span> x)</span></span>&#123;<span class="built_in">write</span>(n),<span class="built_in">putchar</span>(x);<span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt; <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">(TP &amp;n,Etc &amp;...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">read</span>(n)+<span class="built_in">read</span>(etcs...);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> IO;</span><br><span class="line"><span class="keyword">namespace</span> calc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> MOD=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> PHI=<span class="number">1e9</span>+<span class="number">6</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x+y&gt;=MOD?x+y-MOD:x+y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x&lt;y?x-y+MOD:x-y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> (ll)x*y%MOD;&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Add</span>(<span class="built_in">Add</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Red</span>(<span class="built_in">Red</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Mul</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Ksm</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> ans=<span class="number">1</span>)</span></span>&#123;<span class="keyword">while</span>(y&gt;<span class="number">0</span>)&#123;<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=<span class="built_in">Mul</span>(ans,x);x=<span class="built_in">Mul</span>(x,x);y&gt;&gt;=<span class="number">1</span>;&#125;<span class="keyword">return</span> ans;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Inv</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Ksm</span>(x,MOD<span class="number">-2</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> calc;</span><br><span class="line"><span class="type">int</span> T, n, m, cnt;</span><br><span class="line"><span class="type">int</span> F[N];</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> mul[N];</span><br><span class="line"><span class="type">int</span> inv[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">int</span> prime[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; (ll)i * prime[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            mu[i * prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + mu[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">g</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (ll)(sum[r] - sum[l - <span class="number">1</span>]) * (n / l) * (m / l);</span><br><span class="line">    &#125;</span><br><span class="line">    ans %= PHI;</span><br><span class="line">    <span class="keyword">return</span> !ans ? PHI : ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    F[<span class="number">1</span>] = F[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    mul[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    inv[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i &lt;= n; i++)</span><br><span class="line">        F[i] = <span class="built_in">Add</span>(F[i - <span class="number">1</span>], F[i - <span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        mul[i] = <span class="built_in">Mul</span>(mul[i - <span class="number">1</span>], F[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        inv[i] = <span class="built_in">Inv</span>(mul[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(T);</span><br><span class="line">    <span class="built_in">Euler</span>(<span class="number">1e6</span>);</span><br><span class="line">    <span class="built_in">initival</span>(<span class="number">1e6</span>);</span><br><span class="line">    <span class="keyword">while</span> (T-- &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">read</span>(n, m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= <span class="built_in">min</span>(n, m); l = r + <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">            ans = <span class="built_in">Mul</span>(ans, <span class="built_in">Ksm</span>(<span class="built_in">Mul</span>(mul[r], inv[l - <span class="number">1</span>]), <span class="built_in">g</span>(n / l, m / l)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">write</span>(ans, <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-12"><a href="#Question-12" class="headerlink" title="Question 12"></a>Question 12</h3><h4 id="题目-12"><a href="#题目-12" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\tau(ij)\varphi(ij)<br>$$</p>
<h4 id="证明-12"><a href="#证明-12" class="headerlink" title="证明"></a>证明</h4><p>首先了解：</p>
<p>$$<br>\begin{aligned}<br>\tau(n)&amp;&#x3D;\displaystyle\sum_{x\mid n}^{n}1\qquad\text{约数个数的定义}\<br>\tau(ij)&amp;&#x3D;\displaystyle\sum_{x\mid i}^{i}\displaystyle\sum_{y\mid j}^{j}1\<br>\varphi(ij)&amp;&#x3D;\frac{\varphi(i)\varphi(j)\gcd(i,j)}{\varphi(\gcd(i,j))}<br>\end{aligned}<br>$$</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\tau(ij)\varphi(ij)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\varphi(ij)\displaystyle\sum_{x\mid i}\displaystyle\sum_{y\mid j}[\gcd(x,y)&#x3D;1]\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\varphi(ij)\displaystyle\sum_{x\mid i}\displaystyle\sum_{y\mid j}\displaystyle\sum_{d\mid \gcd(x,y)}\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\varphi(ij)\displaystyle\sum_{x\mid i}\displaystyle\sum_{y\mid j}\displaystyle\sum_{d\mid x\land d\mid y}\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\varphi(ij)\displaystyle\sum_{d\mid i\land d\mid j}\displaystyle\sum_{d\mid x\land x\mid i}\displaystyle\sum_{d\mid y\land y\mid j}\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\varphi(ij)\displaystyle\sum_{d\mid \gcd(i,j)}\displaystyle\sum_{xd\mid i}\displaystyle\sum_{yd\mid j}\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\varphi(ij)\displaystyle\sum_{d\mid \gcd(i,j)}\tau(\frac{i}{d})\tau(\frac{j}{d})\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{n}[d\mid i]\displaystyle\sum_{j&#x3D;1}^{m}[d\mid j]\varphi(ij)\tau(\frac{i}{d})\tau(\frac{j}{d})\mu(d)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\varphi(ijd^2)\tau(\frac{id}{d})\tau(\frac{jd}{d})\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}\frac{\varphi(id)\varphi(jd)\gcd(id,jd)}{\varphi(\gcd(id,jd))}\tau(i)\tau(j)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{s&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[\gcd(i,j)&#x3D;s]\frac{\varphi(id)\varphi(jd)ds}{\varphi(ds)}\tau(i)\tau(j)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{ds}\rfloor}[\gcd(i,j)&#x3D;1]\frac{\varphi(ids)\varphi(jds)ds}{\varphi(ds)}\tau(is)\tau(js)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{ds}\rfloor}\displaystyle\sum_{t\mid\gcd(i,j)}\mu(t)\frac{\varphi(ids)\varphi(jds)ds}{\varphi(ds)}\tau(is)\tau(js)\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{t&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\mu(t)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{dst}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{dst}\rfloor}\frac{\varphi(idst)\varphi(jdst)ds}{\varphi(ds)}\tau(ist)\tau(jst)\<br>\end{aligned}<br>$$</p>
<p>整理得到结论：</p>
<p>$$<br>\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\frac{ds}{\varphi(ds)}\displaystyle\sum_{t&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\mu(t)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{dst}\rfloor}\tau(ist)\varphi(dist)\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{dst}\rfloor}\tau(jst)\varphi(djst)<br>$$</p>
<p>发现后面那一部分 $\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{dst}\rfloor}\tau(ist)\varphi(dist)$ 和 $\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{dst}\rfloor}\tau(jst)\varphi(djst)$ 可以预处理，时间复杂度 $O(n\log^2n)$；设 $g(n,d,x)&#x3D;\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{dx}\rfloor}\tau(ix)\varphi(dix)$，预处理完后前面那一部分 $\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\frac{ds}{\varphi(ds)}\displaystyle\sum_{t&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\mu(t)g(n,d,st)g(m,d,st)$ 也是 $O(n\log^2n)$。总体时间复杂度 $O(n\log^2n)$。</p>
<p>你需要筛 $\mu,\varphi,\tau\qquad\text{QWQ}$。</p>
<h4 id="Code-16"><a href="#Code-16" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">namespace</span> calc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> MOD=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x+y&gt;=MOD?x+y-MOD:x+y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x&lt;y?x-y+MOD:x-y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> (ll)x*y%MOD;&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Add</span>(<span class="built_in">Add</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Red</span>(<span class="built_in">Red</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Mul</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Ksm</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> ans=<span class="number">1</span>)</span></span>&#123;<span class="keyword">while</span>(y&gt;<span class="number">0</span>)&#123;<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=<span class="built_in">Mul</span>(ans,x);x=<span class="built_in">Mul</span>(x,x);y&gt;&gt;=<span class="number">1</span>;&#125;<span class="keyword">return</span> ans;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Inv</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Ksm</span>(x,MOD<span class="number">-2</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> calc;</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="type">int</span> g[N];</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> phi[N];</span><br><span class="line"><span class="type">int</span> inv[N];</span><br><span class="line"><span class="type">int</span> sumn[N];</span><br><span class="line"><span class="type">int</span> summ[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    f[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    g[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            g[i] = <span class="number">1</span>;</span><br><span class="line">            f[i] = <span class="number">2</span>;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                g[i * p[j]] = g[i] + <span class="number">1</span>;</span><br><span class="line">                f[i * p[j]] = f[i] / (g[i] + <span class="number">1</span>) * (g[i * p[j]] + <span class="number">1</span>);</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                phi[i * p[j]] = phi[i] * p[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            g[i * p[j]] = <span class="number">1</span>;</span><br><span class="line">            f[i * p[j]] = f[i] * f[p[j]];</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">            phi[i * p[j]] = phi[i] * phi[p[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        inv[i] = <span class="built_in">Inv</span>(phi[i]);</span><br><span class="line">        mu[i] = <span class="built_in">Add</span>(MOD, mu[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span> d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i * d &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        sumn[i] = summ[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; i * j * d &lt;= n; j++)</span><br><span class="line">            sumn[i] = <span class="built_in">Add</span>(sumn[i], <span class="built_in">Mul</span>(f[i * j], phi[i * j * d]));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; i * j * d &lt;= m; j++)</span><br><span class="line">            summ[i] = <span class="built_in">Add</span>(summ[i], <span class="built_in">Mul</span>(f[i * j], phi[i * j * d]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">Euler</span>(<span class="built_in">max</span>(n, m));</span><br><span class="line">    <span class="keyword">if</span> (n &gt; m)</span><br><span class="line">        <span class="built_in">swap</span>(n, m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> d = <span class="number">1</span>; d &lt;= n; d++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">initival</span>(n, m, d); <span class="comment">// 预处理</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> s = <span class="number">1</span>; s * d &lt;= n; s++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> t = <span class="number">1</span>; t * d * s &lt;= n; t++)</span><br><span class="line">                ans = <span class="built_in">Add</span>(ans, <span class="built_in">Mul</span>(mu[d], mu[t], d, s, inv[d * s], sumn[s * t], summ[s * t]));</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">Add</span>(ans, MOD);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-13"><a href="#Question-13" class="headerlink" title="Question 13"></a>Question 13</h3><h4 id="题目-13"><a href="#题目-13" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}\gcd(i,j)\alpha(\gcd(i,j))(i+j)^k<br>$$</p>
<p>$$<br>\alpha(n)&#x3D;<br>\begin{cases}<br>1&amp;\text{n没有平方因子}\<br>0&amp;\text{othses}\<br>\end{cases}<br>$$</p>
<h4 id="证明-13"><a href="#证明-13" class="headerlink" title="证明"></a>证明</h4><p>首先发现 $\alpha(n)&#x3D;\operatorname{abs}(\mu(n))&#x3D;\mu^2(n)$。</p>
<p>然后考虑化简式子：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}\gcd(i,j)\alpha(\gcd(i,j))(i+j)^k<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\alpha(d)d\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}<a href="i+j">\gcd(i,j)&#x3D;d</a>^k\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\alpha(d)d\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}<a href="i+j">\gcd(i,j)&#x3D;1</a>^k\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\alpha(d)d\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{s\mid (\gcd(i,j)}\mu(s)(id+jd)^k\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\alpha(d)d\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}(ids+jds)^k\<br>\end{aligned}<br>$$</p>
<p>套路换元：$T&#x3D;ds$：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{d&#x3D;1}^{n}\alpha(d)d\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}(ids+jds)^k<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\alpha(d)d\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}(iT+jT)^k\<br>&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{n}\displaystyle\sum_{d\mid T}^{n}\alpha(d)\mu(\frac{T}{d})dT^k\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}(i+j)^k<br>\end{aligned}<br>$$</p>
<p>瓶颈有两处，先处理第 $1$ 处：</p>
<ol>
<li><p>$\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}(i+j)^k$</p>
<p> 设 $S(n)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}(i+j)^k$。考虑如何 $O(n)$ 递推。</p>
<p> 大力展开：</p>
<p> $$<br> \begin{aligned}<br> S(n)<br> &amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}(i+j)^k\<br> &amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n-1}\displaystyle\sum_{j&#x3D;1}^{n-1}(i+j)^k+\displaystyle\sum_{i&#x3D;1}^{n}(n+i)^k+\displaystyle\sum_{i&#x3D;1}^{n-1}(i+n)^k\<br> &amp;&#x3D;S(n-1)+\displaystyle\sum_{i&#x3D;n+1}^{2n-1}i^k+\displaystyle\sum_{i&#x3D;n+1}^{2n-1}i^k+(2n)^k\<br> &amp;&#x3D;S(n-1)+2(\displaystyle\sum_{i&#x3D;1}^{2n-1}\operatorname{id_k(i)}-\displaystyle\sum_{i&#x3D;1}^{n}\operatorname{id_k(i)})+\operatorname{id_k(2n)}<br> \end{aligned}<br> $$</p>
<p> 线性筛 $\operatorname{id_k}$ 求前缀和就行了，于是 $O(n)$ 递推出了所有 $S$。</p>
</li>
<li><p>$\displaystyle\sum_{T&#x3D;1}^{n}\displaystyle\sum_{d\mid T}^{n}\alpha(d)\mu(\frac{T}{d})dT^kS(\lfloor\frac{n}{T}\rfloor)$</p>
<p> $T^kS(\lfloor\frac{n}{T}\rfloor)$ 直接 $O(1)$，就是 $\operatorname{id_kT\times S(\lfloor\frac{n}{T}\rfloor)}$，考虑前面那一部分。</p>
<p> $\displaystyle\sum_{T&#x3D;1}^{n}\displaystyle\sum_{d\mid T}^{n}\alpha(d)\mu(\frac{T}{d})d$，直接枚举 $d$ 的倍数预处理，时间复杂度 $O(n\ln n),n\leqslant5\times 10^5$，直接祭掉。</p>
<p> 考虑使用逆狄利克雷后缀和优化，时间复杂度 $O(n\log\log n)$：</p>
<p> 逆狄利克雷后缀和，适用于处理，已知积性函数 $f$ 和正整数 $n$，需要求取积性函数 $g$：</p>
<p> $$<br> g(n)&#x3D;\displaystyle\sum_{d\mid n}f(d)<br> $$</p>
<p> 对于本题，设 $f(n)&#x3D;\mu^2(n)d,g(n)&#x3D;\displaystyle\sum_{d\mid n}\mu^2(d)\mu(\frac{n}{d})d&#x3D;\displaystyle\sum_{d\mid n}f(n)*\mu(\frac{n}{d})$</p>
<p> 两边同时卷 $1$，得到:</p>
<p> $$<br> \begin{aligned}<br> (g<em>1)(n)<br> &amp;&#x3D;(f</em>(u<em>1))(n)\<br> &amp;&#x3D;\displaystyle\sum_{d\mid n}g(d)&#x3D;(f</em>\varepsilon)(n)\<br> &amp;&#x3D;\displaystyle\sum_{d\mid n}g(d)&#x3D;f(n)\<br> \end{aligned}<br> $$</p>
<p> 然后就可以逆狄利克雷后缀和优化求取，最后 $g(n)\times \operatorname{id_k}(n)$ 就是前面那一部分，然后求 $g(n)\times \operatorname{id_k}(n)$ 的前缀和后数论分块，成功了。</p>
<p> 当然这个好像还可以直接线性筛，时间复杂度 $O(n)$。</p>
</li>
</ol>
<h4 id="Code-17"><a href="#Code-17" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> S[N];</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="type">int</span> idk[N];</span><br><span class="line"><span class="type">int</span> sumidk[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="type">int</span> n, m, ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    idk[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            idk[i] = <span class="built_in">pow</span>(i, m);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            idk[i * p[j]] = idk[i] * idk[p[j]];</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sumidk[i] = sumidk[i - <span class="number">1</span>] + idk[i];</span><br><span class="line">    n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        S[i] = S[i - <span class="number">1</span>] + idk[<span class="number">2</span> * i] + <span class="number">2</span> * (sumidk[<span class="number">2</span> * i - <span class="number">1</span>] - sumidk[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = i * mu[i] * mu[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = p.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = n / p[i]; j &gt;= <span class="number">1</span>; j--)</span><br><span class="line">            sum[p[i] * j] -= sum[j];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] *= idk[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] += sum[i - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">Euler</span>(n &lt;&lt; <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">initival</span>(n &lt;&lt; <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans += (sum[r] - sum[l - <span class="number">1</span>]) * S[n / l];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-14"><a href="#Question-14" class="headerlink" title="Question 14"></a>Question 14</h3><h4 id="题目-14"><a href="#题目-14" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{m}\varphi(ij)<br>$$</p>
<p><strong>多组</strong>询问 $1\leqslant T\leqslant 10^4,1\leqslant n\leqslant 10^5$。</p>
<h4 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h4><p>突然让我想起来之前的一道题：</p>
<p>$$<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\tau(ij)\varphi(ij)<br>$$</p>
<p><strong>单组</strong>询问 $1\leqslant n\leqslant 5\times 10^5$。</p>
<p><del>这怕不是弱化版吧</del>。</p>
<p>那道题的式子这么长（折磨我一下午）：</p>
<p>$$<br>\displaystyle\sum_{d&#x3D;1}^{n}\mu(d)\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\frac{ds}{\varphi(ds)}\displaystyle\sum_{t&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\mu(t)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{dst}\rfloor}\tau(ist)\varphi(dist)\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{dst}\rfloor}\tau(jst)\varphi(djst)<br>$$</p>
<p>然而这道题的式子这么短，花费了不到 $10$ 分钟就推出来了（这莫非就是黑题？）：</p>
<p>$$<br>\displaystyle\sum_{d&#x3D;1}^{n}\frac{d}{\varphi(d)}\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\varphi(ids)\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{ds}\rfloor}\varphi(jds)<br>$$</p>
<p>$$<br>\displaystyle\sum_{T&#x3D;1}^{n}\displaystyle\sum_{d\mid T}\frac{d}{\varphi(d)}\mu(\frac{T}{d})\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\varphi(iT)\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{T}\rfloor}\varphi(jT)<br>$$</p>
<p>后来发现这两个式子都没办法处理多组询问，但我还是试了。</p>
<h4 id="新折磨过程"><a href="#新折磨过程" class="headerlink" title="新折磨过程"></a>新折磨过程</h4><h5 id="part-1"><a href="#part-1" class="headerlink" title="part 1"></a>part 1</h5><p>首先第一个式子：按照之前那道黑题的方法处理，时间复杂度：$O(n\log^2n)$。总体时间复杂度 $O(n\ln n+Tn\log^2n)$。由于多组询问，超时的都无语了，喜提 $40$ 分，$14.96s$。</p>
<h5 id="part-2"><a href="#part-2" class="headerlink" title="part 2"></a>part 2</h5><p>第二个式子：经典倍数枚举 $O(n\ln n)$ 预处理 $\displaystyle\sum_{d\mid T}\frac{d}{\varphi(d)}\mu(\frac{T}{d})$，后面那部分在线处理。时间复杂度 $O(n\log n)$。总体时间复杂度 $O(n\ln n+Tn\log n)$。少个 $\log n$ 但是没啥用，还是 $40$ 分，$13.79s$。</p>
<h5 id="part-3"><a href="#part-3" class="headerlink" title="part 3"></a>part 3</h5><p>于是我想狄利克雷卷积了，但是发现 $\displaystyle\sum_{d\mid T}\frac{d}{\varphi(d)}\mu(\frac{T}{d})$ 我卷不动，要是没有那个 $\frac{1}{\varphi(d)}$，就是 $\operatorname{id}*\mu&#x3D;\varphi$，应该会好搞点。但是失败了。</p>
<h5 id="part-4"><a href="#part-4" class="headerlink" title="part 4"></a>part 4</h5><p>还是先 $O(n\ln n)$ 预处理 $\displaystyle\sum_{d\mid T}\frac{d}{\varphi(d)}\mu(\frac{T}{d})$，于是又对于所有的 $T\in[1,1e5]$ 预处理所有的 $\displaystyle\sum_{i&#x3D;1}^{n}\varphi(iT)$，时间复杂度 $O(n\ln n)$，空间复杂度用 <code>vector</code> 动态开 $\frac{n}{T}$，也是 $O(n\ln n)$。然后就是 $O(n)$ 查询，总体时间复杂度 $O(n\ln n+Tn)$。有了新突破，$50$ 分，又少了一个 $\log$。</p>
<h5 id="part-5"><a href="#part-5" class="headerlink" title="part 5"></a>part 5</h5><p>有点崩溃，翻题解去了。</p>
<blockquote>
<p>根号分治</p>
</blockquote>
<p>讨论区：</p>
<blockquote>
<p>给出题人递刀片</p>
</blockquote>
<p>题解区：</p>
<blockquote>
<p>至于如何调整 <strong>块长</strong> 参照 Ynoi</p>
</blockquote>
<p>最后就发现了这么个根号分治的做法，时间复杂度：（我太懒了，就截了题解的图）</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/56yphxxt.png"></p>
<p>题解解得 $S&#x3D;46$ 时时间复杂度最优。</p>
<p>具体就是先预处理一部分 $\displaystyle\sum_{T&#x3D;1}^{n}\displaystyle\sum_{d\mid T}\frac{d}{\varphi(d)}\mu(\frac{T}{d})\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\varphi(iT)\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{T}\rfloor}\varphi(jT)$，怎么处理？</p>
<p>设 $f(n)&#x3D;\displaystyle\sum_{d\mid n}\frac{d}{\varphi(d)}\mu(\frac{n}{d}),g(n,T)&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\varphi(iT)$，$f,n$ 还是原来的方法枚举倍数直接 $O(n\ln n)$ 预处理。然后设 $h$ 是上面那坨式子，得到：</p>
<p>$$<br>\begin{aligned}<br>g(n,T)&amp;&#x3D;g(n-1,T)+\varphi(nT)\<br>h(k,n,m)&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{k}\displaystyle\sum_{d\mid T}\frac{d}{\varphi(d)}\mu(\frac{T}{d})\displaystyle\sum_{i&#x3D;1}^{n}\varphi(iT)\displaystyle\sum_{j&#x3D;1}^{m}\varphi(jT)&#x3D;\displaystyle\sum_{T&#x3D;1}^{k}f(T)g(n,T)g(m,T)<br>\end{aligned}<br>$$</p>
<p>得到 $h$ 的递推式：</p>
<p>$$<br>h(k,n,m)&#x3D;h(k-1,n,m)+f(k)g(n,k)g(m,k)<br>$$</p>
<p>然后只处理 $n,m\leqslant S$ 的这一部分，其余暴力。因为直接预处理 $h$，时间空间都无法接受。</p>
<p>对于大的部分直接数论分块，否则暴力求解。结束了。</p>
<p>额，话说这样的做法还挺神奇的。</p>
<p>但是我们还是需要一些比较官方的语言的，上面那些话有些乱。</p>
<h4 id="证明-14"><a href="#证明-14" class="headerlink" title="证明"></a>证明</h4><p>按照套路：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\varphi(ij)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}\frac{\varphi(i)\varphi(j)\gcd(i,j)}{\varphi(\gcd(i,j))}\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{m}[\gcd(i,j)&#x3D;d]\frac{\varphi(i)\varphi(j)d}{\varphi(d)}\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[\gcd(i,j)&#x3D;1]\frac{\varphi(id)\varphi(jd)d}{\varphi(d)}\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}[s\mid i]\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{d}\rfloor}[s\mid j]\frac{\varphi(id)\varphi(jd)d}{\varphi(d)}\<br>&amp;&#x3D;\displaystyle\sum_{d&#x3D;1}^{n}\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{ds}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{ds}\rfloor}\frac{\varphi(ids)\varphi(jds)d}{\varphi(d)}\<br>&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{n}\displaystyle\sum_{d\mid T}\frac{d}{\varphi(d)}\mu(\frac{T}{d})\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\varphi(iT)\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{T}\rfloor}\varphi(jT)\<br>\end{aligned}<br>$$</p>
<p>设：</p>
<p>$$<br>\begin{aligned}<br>f(x)&amp;&#x3D;\displaystyle\sum_{d\mid x}\frac{d}{\varphi(d)}\mu(\frac{x}{d})\<br>g(x,k)&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{x}\varphi(ik)\<br>\end{aligned}<br>$$</p>
<p>不难发现 $f$ 直接枚举倍数，时间复杂度 $O(n\ln n)$。</p>
<p>至于 $g$ 将他拆开，也可以得到他的递推式：</p>
<p>$$<br>\begin{aligned}<br>g(x,k)<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{x}\varphi(ik)\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{x-1}\varphi(ik)+\varphi(xk)\<br>&amp;&#x3D;g(x-1,k)+\varphi(xk)\<br>\end{aligned}<br>$$</p>
<p>$g(x,k)$ 中 $k$ 的上界便是题目给定的范围 $\operatorname{max}(n,m)$， $x\in[1,\operatorname{max}(n,m)],k\in[1,\lfloor\frac{\operatorname{max}(n,m)}{x}\rfloor]$。因此时间复杂度与空间复杂度均为 $O(n\ln n)$。</p>
<p>此时由于多组查询，$O(n)$ 并不能满足要求，考虑进一步优化：</p>
<p>设 $h(x,a,b)$ 为 $\displaystyle\sum_{T&#x3D;1}^{x}\displaystyle\sum_{d\mid T}\frac{d}{\varphi(d)}\mu(\frac{T}{d})\displaystyle\sum_{i&#x3D;1}^{a}\varphi(iT)\displaystyle\sum_{j&#x3D;1}^{b}\varphi(jT)$。</p>
<p>换元得到：</p>
<p>$$<br>h(x,a,b)&#x3D;\displaystyle\sum_{T&#x3D;1}^{x}f(T)g(a,T)g(b,T)<br>$$</p>
<p>照样拆式子得到递推式：</p>
<p>$$<br>\begin{aligned}<br>h(x,a,b)<br>&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{x}f(T)g(a,T)g(b,T)\<br>&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{x-1}f(T)g(a,T)g(b,T)+f(x)g(a,x)g(b,x)\<br>&amp;&#x3D;h(x-1,a,b)+f(x)g(a,x)g(b,x)<br>\end{aligned}<br>$$</p>
<p>好，把这式子全部预处理出来，时间和空间复杂度 $O(n^2\ln n)$，但是搞出来了就是数论分块了。考虑根号分治：</p>
<p>因为对于 $T$ 越大的数，对应的 $\lfloor\frac{n}{T}\rfloor,\lfloor\frac{m}{T}\rfloor$ 越小，所以我们可以对于小的一部分直接用 $f,g$ 暴力求，假设这个边界为 $S$：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{T&#x3D;1}^{\lfloor\frac{m}{S}\rfloor}\displaystyle\sum_{d\mid T}\frac{d}{\varphi(d)}\mu(\frac{T}{d})\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{T}\rfloor}\varphi(iT)\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{m}{T}\rfloor}\varphi(jT)<br>&amp;&#x3D;\displaystyle\sum_{T&#x3D;1}^{\lfloor\frac{m}{S}\rfloor}f(T)g(\lfloor\frac{n}{T}\rfloor,T)g(\lfloor\frac{m}{T}\rfloor,T)<br>\end{aligned}<br>$$</p>
<p>另一部分数论分块：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{l&#x3D;\lfloor\frac{m}{S}\rfloor+1}^{n}h(r,\lfloor\frac{n}{T}\rfloor,\lfloor\frac{m}{T}\rfloor)-h(l-1,\lfloor\frac{n}{T}\rfloor,\lfloor\frac{m}{T}\rfloor){\text{change l,r by youself}}<br>\end{aligned}<br>$$</p>
<p>时间复杂度就是上面那玩意，我表示并不会证明。</p>
<p>$$<br>n\ln n+nS\ln S+T(\sqrt n+\frac{n}{S})<br>$$</p>
<h4 id="Code-18"><a href="#Code-18" class="headerlink" title="Code"></a>Code</h4><p>还是第一次把多组测试扔上呢，因为没有多组测试，这就是水题。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> S = <span class="number">46</span>;</span><br><span class="line"><span class="keyword">namespace</span> calc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> MOD=<span class="number">998244353</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x+y&gt;=MOD?x+y-MOD:x+y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> x&lt;y?x-y+MOD:x-y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;<span class="keyword">return</span> (ll)x*y%MOD;&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Add</span>(<span class="built_in">Add</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Red</span>(<span class="built_in">Red</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Mul</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Ksm</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> ans=<span class="number">1</span>)</span></span>&#123;<span class="keyword">while</span>(y&gt;<span class="number">0</span>)&#123;<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=<span class="built_in">Mul</span>(ans,x);x=<span class="built_in">Mul</span>(x,x);y&gt;&gt;=<span class="number">1</span>;&#125;<span class="keyword">return</span> ans;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Inv</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Ksm</span>(x,MOD<span class="number">-2</span>);&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> calc;</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; g[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; h[S + <span class="number">5</span>][S + <span class="number">5</span>];</span><br><span class="line"><span class="type">int</span> mu[N];</span><br><span class="line"><span class="type">int</span> phi[N];</span><br><span class="line"><span class="type">bool</span> vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                phi[i * p[j]] = phi[i] * p[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">            phi[i * p[j]] = phi[i] * (p[j] - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        mu[i] = <span class="built_in">Add</span>(mu[i], MOD);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> d = <span class="number">1</span>; d &lt;= n; d++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; d * k &lt;= n; k++)</span><br><span class="line">            f[d * k] = <span class="built_in">Add</span>(f[d * k], <span class="built_in">Mul</span>(d, <span class="built_in">Inv</span>(phi[d]), mu[k]));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        g[k].<span class="built_in">resize</span>(n / k + <span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x * k &lt;= n; x++)</span><br><span class="line">            g[k][x] = <span class="built_in">Add</span>(g[k][x - <span class="number">1</span>], phi[x * k]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> a = <span class="number">1</span>; a &lt;= S; a++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> b = <span class="number">1</span>; b &lt;= S; b++)</span><br><span class="line">        &#123;</span><br><span class="line">            h[a][b].<span class="built_in">resize</span>(n / b + <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x * b &lt;= n; x++)</span><br><span class="line">                h[a][b][x] = <span class="built_in">Add</span>(h[a][b][x - <span class="number">1</span>], <span class="built_in">Mul</span>(f[x], g[x][a], g[x][b]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Euler</span>(<span class="number">1e5</span>);</span><br><span class="line">    <span class="built_in">initival</span>(<span class="number">1e5</span>);</span><br><span class="line">    <span class="type">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T-- &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> n, m, ans = <span class="number">0</span>;</span><br><span class="line">        cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">        <span class="keyword">if</span> (n &gt; m)</span><br><span class="line">            <span class="built_in">swap</span>(n, m);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> T = <span class="number">1</span>; S * T &lt;= m; T++)</span><br><span class="line">            ans = <span class="built_in">Add</span>(ans, <span class="built_in">Mul</span>(f[T], g[T][n / T], g[T][m / T]));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> l = m / S + <span class="number">1</span>, r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            r = <span class="built_in">min</span>(n / (n / l), m / (m / l));</span><br><span class="line">            ans = <span class="built_in">Add</span>(ans, <span class="built_in">Red</span>(h[n / l][m / l][r], h[n / l][m / l][l - <span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; ans &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Question-15"><a href="#Question-15" class="headerlink" title="Question 15"></a>Question 15</h3><h4 id="题目-15"><a href="#题目-15" class="headerlink" title="题目"></a>题目</h4><p>$$<br>\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}\frac{\operatorname{lcm}(i,j)}{\gcd(i,j)}<br>$$</p>
<p>时间限制：$200\operatorname{ms}$</p>
<p>空间限制：$7\operatorname{MB}$</p>
<p>模数：$104857601$</p>
<h4 id="前言-2"><a href="#前言-2" class="headerlink" title="前言"></a>前言</h4><p>这也是比较有意思的题目，和上道题一样，有点前言。主要就是那个时空限制。</p>
<p>先化错了式子，艹了个暴力：$30$ 分。</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}\frac{\operatorname{lcm}(i,j)}{\gcd(i,j)}<br>&amp;&#x3D;\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}\frac{i\times j}{\gcd(i,j)^2}\<br>&amp;&#x3D;\displaystyle\prod_{d&#x3D;1}^{n}\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}(\frac{i\times j}{d^2})^{[\gcd(i,j)&#x3D;d]}\<br>&amp;&#x3D;\displaystyle\prod_{d&#x3D;1}^{n}\displaystyle\prod_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\prod_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}({i\times j})^{[\gcd(i,j)&#x3D;1]}<br>\end{aligned}<br>$$</p>
<p>时间复杂度 $O(n\log^3n)$。</p>
<p>然后换思路，考虑枚举 $\gcd$。</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}\frac{\operatorname{lcm}(i,j)}{\gcd(i,j)}<br>&amp;&#x3D;\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}\frac{i\times j}{\gcd(i,j)^2}\<br>&amp;&#x3D;\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}ij\displaystyle\prod_{d&#x3D;1}^{n}\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}d^{-2[\gcd(i,j)&#x3D;d]}\<br>\end{aligned}<br>$$</p>
<p>遇到这个式子，直接对着指数莫反。</p>
<p>然后就：</p>
<p><img src="http://marchkidjoe.mygamesonline.org/wp-content/uploads/2022/10/MLE.png"></p>
<p>没什么，就是全黑了而已。而已而已而已。啊！！！</p>
<p>真不要紧，只需要：</p>
<ul>
<li><p>把筛 $\mu$ 的数组 $\text{int}\to\text{short}$。</p>
</li>
<li><p>$\text{bool}\to\text{bitset}$</p>
</li>
<li><p>前缀和 $sum$ 的数组 $\text{int}\to\text{short}$。因为我打表发现 $1e6$ 以内的 $\mu$ 的前缀和最大 $311$。</p>
</li>
</ul>
<p>然后就 <code>Accepted</code> 了，时间不用太过于管理，时间复杂度不会分析，反正就是 $O(n)$ 枚举，枚举过程中又套了个数论分块。</p>
<p>卡卡空间就可以过得题了。当然，严谨证明少不了</p>
<h4 id="证明-15"><a href="#证明-15" class="headerlink" title="证明"></a>证明</h4><p>$$<br>\begin{aligned}<br>\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}\frac{\operatorname{lcm}(i,j)}{\gcd(i,j)}<br>&amp;&#x3D;\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}\frac{i\times j}{\gcd(i,j)^2}\<br>&amp;&#x3D;\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}ij\displaystyle\prod_{d&#x3D;1}^{n}\displaystyle\prod_{i&#x3D;1}^{n}\displaystyle\prod_{j&#x3D;1}^{n}d^{-2[\gcd(i,j)&#x3D;d]}\<br>&amp;&#x3D;\displaystyle\prod_{i&#x3D;1}^{n}i\displaystyle\prod_{j&#x3D;1}^{n}j\displaystyle\prod_{d&#x3D;1}^{n}d^{-2\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}[\gcd(i,j)&#x3D;d]}\<br>\end{aligned}<br>$$</p>
<p>指数部分套路反演：</p>
<p>$$<br>\begin{aligned}<br>\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}[\gcd(i,j)&#x3D;d]<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}[\gcd(i,j)&#x3D;1]\<br>&amp;&#x3D;\displaystyle\sum_{i&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{j&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\displaystyle\sum_{s\mid \gcd(i,j)}\mu(s)\<br>&amp;&#x3D;\displaystyle\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\lfloor\frac{n}{ds}\rfloor\lfloor\frac{n}{ds}\rfloor<br>\end{aligned}<br>$$</p>
<p>数论分块即可，然后就可以求出：$\displaystyle\prod_{d&#x3D;1}^{n}d^{-2\displaystyle\sum_{i&#x3D;1}^{n}\displaystyle\sum_{j&#x3D;1}^{n}[\gcd(i,j)&#x3D;d]}$。</p>
<p>最后考虑前半部分：</p>
<p>$\displaystyle\prod_{i&#x3D;1}^{n}i\displaystyle\prod_{j&#x3D;1}^{n}j&#x3D;\displaystyle\prod_{i&#x3D;1}^{n}i\times n!&#x3D;(n!)^{2n}$</p>
<p>总式子：</p>
<p>$$<br>\frac{(n!)^{2n}}{(\prod_{d&#x3D;1}^{n}d^{\sum_{s&#x3D;1}^{\lfloor\frac{n}{d}\rfloor}\mu(s)\lfloor\frac{n}{ds}\rfloor\lfloor\frac{n}{ds}\rfloor})^2}<br>$$</p>
<p>没了，嗷，对了：$(a\times inv(b))\bmod p &#x3D;(a\bmod p)\times (inv(b)\bmod p)$。</p>
<h4 id="Code-19"><a href="#Code-19" class="headerlink" title="Code"></a>Code</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">namespace</span> calc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> MOD=<span class="number">104857601</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">Add</span><span class="params">(ll x,ll y)</span></span>&#123;<span class="keyword">return</span> x+y&gt;=MOD?x+y-MOD:x+y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">Red</span><span class="params">(ll x,ll y)</span></span>&#123;<span class="keyword">return</span> x&lt;y?x-y+MOD:x-y;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">Mul</span><span class="params">(ll x,ll y)</span></span>&#123;<span class="keyword">return</span> x*y%MOD;&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Add</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Add</span>(<span class="built_in">Add</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Red</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Red</span>(<span class="built_in">Red</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TP,<span class="keyword">typename</span>...Etc&gt;<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mul</span><span class="params">(TP n,TP m,Etc ...etcs)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Mul</span>(<span class="built_in">Mul</span>(n,m),etcs...);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">Ksm</span><span class="params">(ll x,ll y,ll ans=<span class="number">1</span>)</span></span>&#123;<span class="keyword">while</span>(y&gt;<span class="number">0</span>)&#123;<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ans=<span class="built_in">Mul</span>(ans,x);x=<span class="built_in">Mul</span>(x,x);y&gt;&gt;=<span class="number">1</span>;&#125;<span class="keyword">return</span> ans;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">Inv</span><span class="params">(ll x)</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Ksm</span>(x,MOD<span class="number">-2</span>);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ll <span class="title">Fac</span><span class="params">(ll x)</span></span>&#123;ll ans=<span class="number">1</span>;<span class="keyword">while</span>(x)ans=<span class="built_in">Mul</span>(ans,x--);<span class="keyword">return</span> ans;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> calc;</span><br><span class="line"><span class="type">short</span> mu[N];</span><br><span class="line"><span class="type">short</span> sum[N];</span><br><span class="line">bitset&lt;N&gt; vis;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Euler</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i])</span><br><span class="line">        &#123;</span><br><span class="line">            p.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; p.<span class="built_in">size</span>() &amp;&amp; i * p[j] &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            vis[i * p[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % p[j] == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * p[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initival</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + mu[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">f</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">1</span>; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans += (ll)(sum[r] - sum[l - <span class="number">1</span>]) * (n / l) * (n / l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">1</span>, n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="built_in">Euler</span>(n);</span><br><span class="line">    <span class="built_in">initival</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> d = <span class="number">1</span>; d &lt;= n; d++)</span><br><span class="line">        ans = <span class="built_in">Mul</span>(ans, <span class="built_in">Ksm</span>(d, <span class="built_in">f</span>(n / d)));</span><br><span class="line">    cout &lt;&lt; <span class="built_in">Mul</span>(<span class="built_in">Ksm</span>(<span class="built_in">Fac</span>(n), n &lt;&lt; <span class="number">1</span>), <span class="built_in">Ksm</span>(<span class="built_in">Inv</span>(ans), <span class="number">2</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>Problem 0:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2158">P2158 [SDOI2008] 仪仗队</a></p>
<p>Problem 1:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3455">P3455 [POI2007]ZAP-Queries</a></p>
<p>Problem 2:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2257">P2257 YY的GCD</a></p>
<p>Problem 3:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2522">P2522 [HAOI2011]Problem b</a></p>
<p>Problem 4:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2398">P2398 GCD SUM</a></p>
<p>Problem 5:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1829">P1829 [国家集训队]Crash的数字表格 &#x2F; JZPTAB</a></p>
<p>Problem 6:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3327">P3327 [SDOI2015]约数个数和</a></p>
<p>Problem 7:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3768">P3768 简单的数学题</a></p>
<p>Problem 8:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4449">P4449 于神之怒加强版</a></p>
<p>Problem 9:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P6810">P6810 「MCOI-02」Convex Hull 凸包</a></p>
<p>Problem 10:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3312">P3312 [SDOI2014]数表</a></p>
<p>Problem 11:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3704">P3704 [SDOI2017]数字表格</a></p>
<p>Problem 12:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P8570">P8570 [JRKSJ R6] 牵连的世界</a></p>
<p>Problem 13:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P6156">P6156 简单题</a></p>
<p>Problem 14:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4240">P4240 毒瘤之神的考验</a></p>
<p>Problem 15:<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5221">P5221 Product</a></p>
<h2 id="多倍经验"><a href="#多倍经验" class="headerlink" title="多倍经验"></a>多倍经验</h2><p>Problem 1:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4450">P4450 双亲数</a></li>
</ul>
<p>Problem 2:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2568">P2568 GCD</a></li>
</ul>
<p>Problem 4:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1390">P1390 公约数的和</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1447">P1447 [NOI2010] 能量采集</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/UVA11417">UVA11417 GCD</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/UVA11424">UVA11424 GCD - Extreme (I)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/UVA11426">UVA11426 拿行李（极限版） GCD - Extreme (II)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP3871">SP3871 GCDEX - GCD Extreme</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP19985">SP19985 GCDEX2 - GCD Extreme (hard)</a></li>
</ul>
<h2 id="后言"><a href="#后言" class="headerlink" title="后言"></a>后言</h2><p>代码并非全都 <code>Accepted</code>，因为为了<strong>防止代码臃肿</strong>，所以删去了<strong>取模和多组测试</strong>，但是思路和代码框架上不会出问题。这是有史以来个人博客写的最长的。</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title="0" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                        
                            <li title="1" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                </ul>
            
        </div>
        
        
    <div id="gitalk-container" class="comment link"
		data-enable="false"
        data-ae="false"
        data-ci=""
        data-cs=""
        data-r=""
        data-o=""
        data-a=""
        data-d="false"
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
